<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='1. Overview A distributed system is one in which the failure of a coumputer you didn&amp;rsquo;t even know existed can render your own computer unusable. UCB Âõ¢ÈòüÂú® 2009 Âπ¥ÂèëË°®ÁöÑËÆ∫Êñá Above the Clouds: A Berkeley View of Cloud ComputingÔºåÈ¢ÑÊµã‰∫Ü‰∫ëËÆ°ÁÆóÊú∫ÁöÑ‰ª∑ÂÄº„ÄÅÊºîËøõÂíåÊôÆÂèä'>
<title>Distributed Systems</title>

<link rel='canonical' href='https://chasing1020.github.io/post/distributed-systems/'>

<link rel="stylesheet" href="/scss/style.min.4103f793779d705fbe87a822f76011a76b5b1b9090509fd3b17a3ca449768b2a.css"><meta property='og:title' content='Distributed Systems'>
<meta property='og:description' content='1. Overview A distributed system is one in which the failure of a coumputer you didn&amp;rsquo;t even know existed can render your own computer unusable. UCB Âõ¢ÈòüÂú® 2009 Âπ¥ÂèëË°®ÁöÑËÆ∫Êñá Above the Clouds: A Berkeley View of Cloud ComputingÔºåÈ¢ÑÊµã‰∫Ü‰∫ëËÆ°ÁÆóÊú∫ÁöÑ‰ª∑ÂÄº„ÄÅÊºîËøõÂíåÊôÆÂèä'>
<meta property='og:url' content='https://chasing1020.github.io/post/distributed-systems/'>
<meta property='og:site_name' content='Chasing1020'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2023-04-05T19:23:12&#43;08:00'/><meta property='article:modified_time' content='2023-04-05T19:23:12&#43;08:00'/><meta property='og:image' content='https://chasing1020.github.io/post/distributed-systems/distributed-network.jpeg' />
<meta name="twitter:site" content="@Chasing1020">
    <meta name="twitter:creator" content="@Chasing1020"><meta name="twitter:title" content="Distributed Systems">
<meta name="twitter:description" content="1. Overview A distributed system is one in which the failure of a coumputer you didn&amp;rsquo;t even know existed can render your own computer unusable. UCB Âõ¢ÈòüÂú® 2009 Âπ¥ÂèëË°®ÁöÑËÆ∫Êñá Above the Clouds: A Berkeley View of Cloud ComputingÔºåÈ¢ÑÊµã‰∫Ü‰∫ëËÆ°ÁÆóÊú∫ÁöÑ‰ª∑ÂÄº„ÄÅÊºîËøõÂíåÊôÆÂèä"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://chasing1020.github.io/post/distributed-systems/distributed-network.jpeg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu95eb581bc5d2486d92921983fc6c7583_36979_300x0_resize_q75_box.jpg" width="300"
                            height="299" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üñ•Ô∏è</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Chasing1020</a></h1>
            <h2 class="site-description">
                <a href="https://www.youtube.com/watch?v=_ILsdcs__ME" target="_blank">
                    Why there is a universe?
                </a>
            </h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/Chasing1020'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/Chasing1020'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://t.me/Chasing1020'
                        target="_blank"
                        title="Telegram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
</svg>

                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:chasing1020@gmail.com'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="3" y="5" width="18" height="14" rx="2" />
  <polyline points="3 7 12 13 21 7" />
</svg>

                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='/index.xml'
                        target="_blank"
                        title="RSS"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="5" cy="19" r="1" />
  <path d="M4 4a16 16 0 0 1 16 16" />
  <path d="M4 11a9 9 0 0 1 9 9" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/friends/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Friends</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
      
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#1-overview">1. Overview</a></li>
    <li><a href="#2-the-system-models">2. The System Models</a></li>
    <li><a href="#3-distributed-clock">3. Distributed Clock</a>
      <ul>
        <li><a href="#31-synchronization">3.1. Synchronization</a></li>
        <li><a href="#32-logical-clock">3.2. Logical Clock</a></li>
        <li><a href="#33-vector-clock">3.3. Vector Clock</a></li>
      </ul>
    </li>
    <li><a href="#4-distributed-data">4. Distributed Data</a>
      <ul>
        <li><a href="#41-partitioning">4.1. Partitioning</a></li>
        <li><a href="#42-replication">4.2. Replication</a></li>
        <li><a href="#43-cap-theorem">4.3. CAP Theorem</a></li>
        <li><a href="#44-consistency-model">4.4. Consistency Model</a></li>
        <li><a href="#45-isolation-level">4.5. Isolation Level</a></li>
      </ul>
    </li>
    <li><a href="#5-distributed-consensus">5. Distributed Consensus</a>
      <ul>
        <li><a href="#51-flp-impossibility">5.1. FLP Impossibility</a></li>
        <li><a href="#52-paxos">5.2. Paxos</a></li>
        <li><a href="#53-raft">5.3. Raft</a></li>
        <li><a href="#54-pbft">5.4. PBFT</a></li>
      </ul>
    </li>
    <li><a href="#6-distributed-transactions">6. Distributed Transactions</a>
      <ul>
        <li><a href="#61-2pc">6.1. 2PC</a></li>
        <li><a href="#62-3pc">6.2. 3PC</a></li>
        <li><a href="#63-paxos-commit">6.3. Paxos Commit</a></li>
        <li><a href="#64-saga">6.4. Saga</a></li>
        <li><a href="#65-percolator">6.5. Percolator</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/post/distributed-systems/">
                <img src="/post/distributed-systems/distributed-network_hu0a4f0ad221ff8e3224bc9c851bbac464_346580_800x0_resize_q75_box.jpeg"
                        srcset="/post/distributed-systems/distributed-network_hu0a4f0ad221ff8e3224bc9c851bbac464_346580_800x0_resize_q75_box.jpeg 800w, /post/distributed-systems/distributed-network_hu0a4f0ad221ff8e3224bc9c851bbac464_346580_1600x0_resize_q75_box.jpeg 1600w"
                        width="800" 
                        height="533" 
                        loading="lazy"
                        alt="Featured image of post Distributed Systems" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/distributed-systems/">Distributed Systems</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 05, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    33 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="1-overview">1. Overview</h1>
<blockquote>
<p><a class="link" href="https://lamport.azurewebsites.net/pubs/distributed-system.txt"  target="_blank" rel="noopener"
    >A distributed system is one in which the failure of a coumputer you didn&rsquo;t even know existed can render your own computer unusable.</a></p>
</blockquote>
<p>UCB Âõ¢ÈòüÂú® 2009 Âπ¥ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2009/EECS-2009-28.pdf"  target="_blank" rel="noopener"
    >Above the Clouds: A Berkeley View of Cloud Computing</a>ÔºåÈ¢ÑÊµã‰∫Ü‰∫ëËÆ°ÁÆóÊú∫ÁöÑ‰ª∑ÂÄº„ÄÅÊºîËøõÂíåÊôÆÂèäÁöÑËøõÁ®ãÔºõËÄå 2019 Âπ¥ÁöÑËÆ∫Êñá <a class="link" href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2019/EECS-2019-3.pdf"  target="_blank" rel="noopener"
    >Cloud Programming Simplified: A Berkeley View on Serverless Computing</a>ÔºåÂàôÊèêÂá∫‰∫Ü‰∏ÄÁßçÊñ∞ÁöÑÁåúÊµãÔºö‚ÄúÊó†ÊúçÂä°‰ºöÂèëÂ±ïÊàêÊú™Êù•‰∫ëËÆ°ÁÆóÁöÑ‰∏ªË¶ÅÂΩ¢Âºè‚ÄùÔºåÊó†ÊúçÂä°Êû∂ÊûÑ‰∏ãÁöÑÁî®Êà∑‰∏çÂÜçÈúÄË¶ÅÂÖ≥ÂøÉÁªÜËäÇÔºåËÄåÊûÅÂ§ßËß£ÊîæÁîü‰∫ßÂäõ„ÄÇ</p>
<p>ÈòøÈáåÂ∑¥Â∑¥Âõ¢ÈòüÊâÄÁºñÂÜôÁöÑ<a class="link" href="https://developer.aliyun.com/topic/cn-architecture-paper?spm=a2c6h.12873639.article-detail.4.147c6c7ewSNSJn"  target="_blank" rel="noopener"
    >‰∫ëÂéüÁîüÊû∂ÊûÑÁôΩÁöÆ‰π¶</a>‰πüÈ¢ÑË®ÄÂú®Êú™Êù•ÂçÅÂπ¥Ôºå‰∫ëËÆ°ÁÆóÂ∞ÜÊó†Â§Ñ‰∏çÂú®ÔºåÂÉèÊ∞¥ÁîµÁÖ§‰∏ÄÊ†∑Êàê‰∏∫Êï∞Â≠óÁªèÊµéÊó∂‰ª£ÁöÑÂü∫Á°ÄËÆæÊñΩÔºå‰∫ëÂéüÁîüËÆ©‰∫ëËÆ°ÁÆóÂèòÂæóÊ†áÂáÜ„ÄÅÂºÄÊîæ„ÄÅÁÆÄÂçïÈ´òÊïà„ÄÅËß¶ÊâãÂèØÂèä„ÄÇ</p>
<p>‰∏ÄËà¨Êù•ËØ¥ÔºåÁé∞‰ª£ÁöÑÂàÜÂ∏ÉÂºèËÆ°ÁÆóÁöÑÊúçÂä°Ê®°ÂûãÂü∫Êú¨ÂàÜ‰∏∫Â¶Ç‰∏ã‰∏Ä‰∫õÁ±ªÂà´Ôºö</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>SaaS</td>
<td>Web services, multimedia, business apps</td>
<td>Web services, multimedia, business apps</td>
</tr>
<tr>
<td>PaaS</td>
<td>Software framework (Java/Go), Database systems</td>
<td>MS Azure Google App engine</td>
</tr>
<tr>
<td>IaaS</td>
<td>Computation (VM), storage (block, file)</td>
<td>Amazon S3; Amazon EC2</td>
</tr>
<tr>
<td>Hardware</td>
<td>CPU, memory, disk, bandwidth</td>
<td>Datacenters</td>
</tr>
</tbody>
</table></div>
<p>‰∏∫‰∫ÜÂÆûÁé∞Ëøô‰∫õÂàÜÂ±ÇÔºåÂØπÁî®Êà∑ÈÄèÊòéÔºåÈúÄË¶ÅÂæàÂ§öÁöÑÊäΩË±°ÔºåAndrew Tanenbaum Âú®Âõæ‰π¶ <a class="link" href="https://www.distributed-systems.net/index.php/books/ds4/"  target="_blank" rel="noopener"
    >Distributed Systems Principles and Paradigms</a> ‰∏≠Ôºå‰πüÁªôÂá∫‰∫ÜÁ≥ªÁªüÈÄèÊòéÊÄßÁöÑÂêÑ‰∏™ËßíÂ∫¶ÁöÑÊèèËø∞„ÄÇ</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:center">Transparency</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Access</td>
<td style="text-align:left">Hide differences in data representation and how an object is accessed</td>
</tr>
<tr>
<td style="text-align:center">Location</td>
<td style="text-align:left">Hide where an object is located</td>
</tr>
<tr>
<td style="text-align:center">Relocation</td>
<td style="text-align:left">Hide that an object may be moved to another location while in use</td>
</tr>
<tr>
<td style="text-align:center">Migration</td>
<td style="text-align:left">Hide that an object may move to another location</td>
</tr>
<tr>
<td style="text-align:center">Replication</td>
<td style="text-align:left">Hide that an object is replicated</td>
</tr>
<tr>
<td style="text-align:center">Concurrency</td>
<td style="text-align:left">Hide that an object may be shared by several independent users</td>
</tr>
<tr>
<td style="text-align:center">Failure</td>
<td style="text-align:left">Hide the failure and recovery of an object</td>
</tr>
</tbody>
</table></div>
<p>‰∏∫‰∫ÜÂÆûÁé∞‰∏Ä‰∏™ÂΩªÂ∫ïÈÄèÊòéÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªüËøòÊúâÈùûÂ∏∏Â§öÁöÑÊåëÊàòÔºåÊó©Âú® 20 ‰∏ñÁ∫™ 90 Âπ¥‰ª£ÔºåL. Peter Deutsch Á≠â‰∫∫ÊÄªÁªìÂá∫‰∫ÜÂàÜÂ∏ÉÂºèËÆ°ÁÆóÁöÑË∞¨ËØØÔºà<a class="link" href="https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing"  target="_blank" rel="noopener"
    >The Fallacies of Distributed Computing</a>ÔºâÔºö</p>
<ol>
<li>The network is reliable; ÁΩëÁªúÊòØÂèØÈù†ÁöÑ</li>
<li>Latency is zero; Âª∂Ëøü‰∏∫Èõ∂</li>
<li>Bandwidth is infinite; Â∏¶ÂÆΩÊòØÊó†ÈôêÁöÑ</li>
<li>The network is secure; ÁΩëÁªúÊòØÂÆâÂÖ®ÁöÑ</li>
<li>Topology doesn&rsquo;t change; ÊãìÊâëÁªìÊûÑ‰∏ç‰ºöÊîπÂèò</li>
<li>There is one administrator; Âçï‰∏ÄÁöÑÁÆ°ÁêÜÂëò</li>
<li>Transport cost is zero; ‰º†ËæìÊàêÊú¨‰∏∫ 0</li>
<li>The network is homogeneous. ÁΩëÁªúÊòØÂêåÊûÑÁöÑ</li>
</ol>
<p>ÂÆûÈôÖ‰∏äÔºåÂú®ÁúüÂÆûÁöÑ‰∏ñÁïå‰∏≠ÔºåÂàÜÂ∏ÉÂºèÁ≥ªÁªüÂÖÖÊª°‰∫ÜÂêÑÁßçÊåëÊàòÔºåÂÖ∂‰∏≠‰∏ªË¶ÅÂåÖÊã¨Â¶Ç‰∏ã‰∏âÁÇπÔºö</p>
<ol>
<li>‰∏çÂèØÈù†ÁöÑÁΩëÁªúÔºöÊ∂àÊÅØÂèØËÉΩ‰∏¢Â§±„ÄÅÊã•Â°û„ÄÅÊéíÈòü„ÄÅÈáç‰º†„ÄÅ‰∏ç‰∏ÄÂÆöÊåâÂ∫èÂà∞Ëææ„ÄÇÂç≥‰æøÊúâ‰∫Ü TCP ËøôÊ†∑ÁöÑÂçèËÆÆÔºåÂú®ÁΩëÁªúÁ°¨‰ª∂ËÆæÂ§á‰∏äÂêåÊ†∑ÊòØ‰∏çÂèØÈù†ÁöÑ„ÄÇ</li>
<li>‰∏çÂèØÈù†ÁöÑËøõÁ®ãÔºöÁ≥ªÁªüÂèØËÉΩÈÉ®ÂàÜËäÇÁÇπÊ≠£Â∏∏Â∑•‰ΩúÔºå‰ΩÜÊòØÂè¶‰∏ÄÈÉ®ÂàÜ‰∏çËÉΩÊ≠£Â∏∏ËøêË°åÔºõÁî±‰∫éÁºñÁ®ãËØ≠Ë®ÄÁöÑÂûÉÂúæÂõûÊî∂ÔºàGCÔºâÔºåÂú®ËôöÊãüÂåñÁéØÂ¢É‰∏≠ÁöÑÊåÇËµ∑ÔºàSuspendÔºâÔºåÊìç‰ΩúÁ≥ªÁªüÁöÑ‰∏ä‰∏ãÊñáÂàáÊç¢ÔºåÂêåÊ≠•Á£ÅÁõòÁöÑËÆøÈóÆÁ≠âÁ≠â‰∏çÁ°ÆÂÆöÊÄßÂíåÂ§±ÊïàÁöÑÂèØËÉΩÔºå‰ΩøÂæóÂàÜÂ∏ÉÂºèÁ≥ªÁªüÈöæ‰ª•Ë∞ÉËØïÔºåÂ∞§ÂÖ∂ÊòØÂØπ‰∫éÈúÄË¶ÅÂéüÂ≠êÊìç‰ΩúÁöÑÂú∫ÊôØÔºåÈÉ®ÂàÜÂ§±Êïà‰ºöÂ∏¶Êù•ÂæàÂ§ßÁöÑÂ§çÊùÇÊÄß‰∏éÊåëÊàò„ÄÇ</li>
<li>‰∏çÂèØÈù†ÁöÑÊó∂ÈíüÔºöÁî±‰∫éÈÄö‰ø°‰∏çÊòØÂç≥Êó∂ÁöÑÔºåÁΩëÁªúÂª∂ËøüÊ∞∏ËøúÈÉΩÂú®ÂèëÁîüÔºå‰∏çÂÉèÂçïÊú∫Á≥ªÁªü‰∏≠ÊØè‰∏™ËøõÁ®ãÈÉΩÊúâ‰∏Ä‰∏™ÂÖ±ÂêåÁöÑÊó∂Èó¥„ÄÇ‰∏ÄÁßçËß£ÂÜ≥ÊñπÊ°àÊòØËÆæÁΩÆÊó∂Èó¥ÊúçÂä°Âô®Êù•ÂêåÊ≠•Êó∂Èó¥Ôºà‰æùÊóßÂ≠òÂú®ÁΩëÁªúÂèØÂèòÂª∂ËøüÈóÆÈ¢òÔºåËÄå‰∏îÂêåÊ≠•Âêé‰πüÊú™ÂøÖÁ≤æÂáÜÔºâÔºõ‰ΩøÁî® <a class="link" href="https://research.google.com/pubs/archive/45855.pdf"  target="_blank" rel="noopener"
    >Spanner, TrueTime</a>ÔºõÊàñËÄÖ‰ΩøÁî® <a class="link" href="http://lamport.azurewebsites.net/pubs/time-clocks.pdf?from=https://research.microsoft.com/users/lamport/pubs/time-clocks.pdf&amp;type=path"  target="_blank" rel="noopener"
    >Lamport ÁöÑÈÄªËæëÊó∂Èíü</a>Êù•Á°ÆÂÆöÊó∂Â∫èÁ≠â„ÄÇ</li>
</ol>
<h1 id="2-the-system-models">2. The System Models</h1>
<blockquote>
<p><a class="link" href="https://queue.acm.org/detail.cfm?id=2655736"  target="_blank" rel="noopener"
    >All of which prove to be false in the long run and all of which cause big trouble and painful learning experiences.</a></p>
</blockquote>
<p>‰∏§Â∞ÜÂÜõÈóÆÈ¢òÔºà<a class="link" href="https://en.wikipedia.org/wiki/Two_Generals%27_Problem"  target="_blank" rel="noopener"
    >Two General&rsquo;s Problem</a>ÔºâÔºö‰∏§ÊîØÂÜõÈòüÊîªÊâìÂêå‰∏Ä‰∏™ÂüéÂ†°ÔºåÁÑ∂ËÄå‰∏§‰∏™ÂÜõÈòüÈÄö‰ø°Ë¢´Â±±Ë∞∑ÈöîÂºÄÔºå‰ø°ÊÅØ‰º†ÈÄíÁöÑ‰ø°‰ΩøÈöèÊó∂ÂèØËÉΩË¢´‰øòËôèÔºåËÄå‰∏î‰∏§‰∏™ÂÜõÈòüÈúÄË¶ÅÂêåÊó∂ËææÊàêËøõÊîªÊàñËÄÖÊí§ÈÄÄÁöÑ‰∏ÄËá¥„ÄÇËøô‰∏™ÈóÆÈ¢òÂ∑≤ÁªèË¢´ Lamport ÁöÑËÆ∫Êñá <a class="link" href="https://lamport.azurewebsites.net/pubs/solved-and-unsolved.pdf"  target="_blank" rel="noopener"
    >Solved Problems, Unsolved Problems and Non-Problems in Concurrency</a> ËØÅÊòéÊó†Ëß£Ôºå‰∏çËøáÂú®Â∑•Á®ã‰∏äÁöÑËß£ÂÜ≥ÊñπÊ°àÂç≥ÊòØ TCP ÁöÑ‰∏âÊ¨°Êè°Êâã„ÄÇËøõ‰∏ÄÊ≠•ËØ¥ÊòéÔºåÂú®‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÊüê‰∏™ËäÇÁÇπÂ¶ÇÊûúÈúÄË¶ÅÁ°ÆËÆ§Âè¶‰∏Ä‰∏™ËäÇÁÇπÁöÑÁä∂ÊÄÅÔºåÂîØ‰∏ÄÁöÑÊñπÊ≥ïÂ∞±ÊòØËøõË°åÂèØÈù†ÁöÑÊ∂àÊÅØÈÄö‰ø°„ÄÇ</p>
<p>ÊãúÂç†Â∫≠Â∞ÜÂÜõÈóÆÈ¢òÔºà<a class="link" href="https://en.wikipedia.org/wiki/Byzantine_fault"  target="_blank" rel="noopener"
    >The Byzantine Generals Problem</a>ÔºâÔºöÊúâ n ‰∏™ÊãúÂç†Â∫≠Â∞ÜÂÜõÔºå‰ªñ‰ª¨Â∏åÊúõÂú®ËøõÊîª/Êí§ÈÄÄ‰∏äËææÊàê‰∏ÄËá¥ÔºåÂ∞ÜÂÜõ‰ª¨Âè™ËÉΩÈÄöËøá‰ø°‰ΩøËøõË°å‰∫§ÊµÅÔºå‰ΩÜÊòØ‰ø°‰ΩøÂèØËÉΩÊúâÂèõÂæí„ÄÇLamport ÁªôÂá∫‰∫ÜÊúÄÁªàËØÅÊòéÔºå<a class="link" href="https://lamport.azurewebsites.net/pubs/byz.pdf"  target="_blank" rel="noopener"
    >Ëá≥Â∞ëË¶Å 3n+1 ‰∏™ËÆ°ÁÆóÊú∫ÔºåÊâçËÉΩ‰øùËØÅÂÖ∂‰∏≠ÁöÑ n ‰∏™‚ÄúÂèõÂæí‚Äù‰∏ç‰ºöÈòªÁ¢çÊ≠£Á°ÆÊìç‰ΩúÁöÑËÆ°ÁÆóÊú∫ËææÊàêÂÖ±ËØÜ</a>„ÄÇ</p>
<p>ÁΩëÁªúÈìæË∑ØÊ®°ÂûãÔºöÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÁΩëÁªúÊ∞∏ËøúÈÉΩÊúâÂèØËÉΩÂèëÁîüÂàÜÂå∫ÔºàNetwork PartitionÔºâÔºåÂ∞ÜÁΩëÁªúËøõË°åÊäΩË±°ÔºåÂè™ËÄÉËôëÁÇπÂØπÁÇπÁöÑÈìæË∑ØÔºåÂèØÂ§ßËá¥ÂàÜ‰∏∫</p>
<ol>
<li>ÂèØÈù†ÈìæË∑ØÔºàReliable Link or Perfect LinkÔºâÔºöTCP ÁöÑÁºñÁ®ãÊ®°ÂûãÔºåÂèØ‰ª•‰øùËØÅÔºöÊ∂àÊÅØ‰º†ÈÄí‰∏ÄÂÆöÂèØÈù†„ÄÅÊ≤°ÊúâÈáçÂ§çÊ∂àË¥π„ÄÅ‰∏ç‰ºöÊó†‰∏≠ÁîüÊúâÊ∂àÊÅØ„ÄÇ</li>
<li>ÂÖ¨Âπ≥ÊçüÂ§±ÈìæË∑ØÔºàFair-Loss LinkÔºâÔºöÊ∂àÊÅØÂèØËÉΩ‰∏¢Â§±„ÄÅÈáçÂ§çÊàñËÄÖ‰π±Â∫èÔºå‰ΩÜÊòØËÉΩ‰øùËØÅÊ∂àÊÅØÊúÄÁªà‰∏ÄÂÆö‰ºöÂà∞Ëææ„ÄÇ</li>
<li>‰ªªÊÑèÈìæË∑ØÔºàArbitrary LinkÔºâÔºöÊúÄÂº±ÁöÑÁºñÁ®ãÊ®°ÂûãÔºåÂÖÅËÆ∏‰ªªÊÑèÁΩëÁªúÈìæË∑ØÊâßË°å‰ªªÊÑèÊìç‰Ωú„ÄÇ‰ΩøÁî® TLS Á≠âÂä†ÂØÜÊäÄÊúØÂèØ‰ª•ËΩ¨Êç¢ÊàêÂÖ¨Âπ≥ÊçüÂ§±ÈìæË∑Ø</li>
</ol>
<p>ËäÇÁÇπÊïÖÈöúÊ®°ÂûãÔºöËäÇÁÇπÂèØËÉΩÂá∫Áé∞ÊïÖÈöúÔºå‰∏ªË¶ÅÂåÖÊã¨‰ª•‰∏ã‰∏âÁßç</p>
<ol>
<li>Â¥©Ê∫É-ÂÅúÊ≠¢Ôºàfail-stop or crash-stopÔºâÔºö‰∏Ä‰∏™ËäÇÁÇπÂ¥©Ê∫ÉÂêéÊ∞∏Ëøú‰∏ç‰ºöÊÅ¢Â§ç„ÄÇ</li>
<li>Â¥©Ê∫É-ÊÅ¢Â§çÔºàfail-recover or crash-recoveryÔºâÔºöÂÖÅËÆ∏ËäÇÁÇπÈáçÊñ∞ÂêØÂä®ÂêéÁªßÁª≠ÊâßË°åÂâ©‰ΩôÁöÑÊ≠•È™§„ÄÇ</li>
<li>ÊãúÂç†Â∫≠ÊïÖÈöúÔºàByzantine faultÔºâÔºöÊïÖÈöúÁöÑËäÇÁÇπ‰∏ç‰ªÖ‰ºöÂÅèÁ¶ªÁä∂ÊÄÅÔºåËøò‰ºöÊÅ∂ÊÑèÁ†¥ÂùèÁ≥ªÁªü„ÄÇ</li>
</ol>
<p>Ê∂àÊÅØ‰º†ÈÄíÊ®°ÂûãÔºöÂêÑ‰∏™ËäÇÁÇπÈÄöËøá‰º†ÈÄíÊ∂àÊÅØËøõË°åÈÄö‰ø°ÔºåÂ∏∏ËßÅËß£ÂÜ≥ÊñπÊ°àÂ¶ÇÊ∂àÊÅØ‰∏¢Â§±-&gt;Èáç‰º†ÔºåÊ∂àÊÅØÈáçÂ§çÊ∂àË¥π-&gt;ÈááÁî®ÂπÇÁ≠âÊñπÊ°à„ÄÇ</p>
<h1 id="3-distributed-clock">3. Distributed Clock</h1>
<p>Ê†ºÊûóÂ∞ºÊ≤ªÊ†áÂáÜÊó∂Èó¥ÔºàGreenwich Mean Time, GMTÔºâÔºöÂèàÁß∞Ê†ºÊûóÂ∞ºÊ≤ªÂπ≥ÂùáÊó∂Èó¥ÔºåÊòØÊåá‰Ωç‰∫éËã±ÂõΩ‰º¶Êï¶ÈÉäÂå∫ÁöÑÁöáÂÆ∂Ê†ºÊûóÂ∞ºÊ≤ªÂ§©ÊñáÂè∞ÂΩìÂú∞ÁöÑÂπ≥Â§™Èò≥Êó∂ÔºåÂõ†‰∏∫Êú¨ÂàùÂ≠êÂçàÁ∫øË¢´ÂÆö‰πâ‰∏∫ÈÄöËøáÈÇ£ÈáåÁöÑÁªèÁ∫ø„ÄÇ</p>
<p>‰∏ñÁïåÂçèË∞ÉÊó∂Èó¥ÔºàCoordinated Universal Time, UTCÔºâÔºö‰Ωú‰∏∫‰∏ÄÁßç‰∏ñÁïåÁöÑÊó∂Èó¥Ê†áÂáÜÔºåÂü∫‰∫éÂõΩÈôÖÂéüÂ≠êÊó∂ÔºåÂπ∂ÈÄöËøá‰∏çËßÑÂàôÊ∑ªÂä†Ê≠£Ë¥üÈó∞ÁßíÊù•ÊäµÊ∂àÂú∞ÁêÉËá™ËΩ¨ÂèòÈáèÁöÑÂΩ±ÂìçÔºåÂπ∂Âú®Êó∂Âàª‰∏äÂ∞ΩÈáèÊé•ËøëÊ†ºÊûóÂ∞ºÊ≤ªÊ†áÂáÜÊó∂Èó¥ÔºàGreenwich Mean Time, GMTÔºâ„ÄÇ</p>
<p>UNIX Êó∂Èó¥Êà≥ÔºàTimestampÔºâÔºöËÆ°ÁÆó‰ªé UTC ÁöÑ 1970 Âπ¥ 1 Êúà 1 Êó• 0 Êó∂ 0 ÂàÜ 0 ÁßíÂºÄÂßãÁªèËøáÁöÑÊó∂Èó¥ÔºåÂΩìÂá∫Áé∞Èó∞ÁßíÈóÆÈ¢òÊó∂ÔºåÈÄöËøá‚ÄúÈôçÈÄü‚ÄùÈóÆÈ¢òËß£ÂÜ≥ÔºåÂç≥Âá∫Áé∞Èó∞ÁßíÂêéÔºåÂú®Êú™Êù•ÁöÑÂçÅÂ∞èÊó∂ÂÜÖÔºåÂàªÊÑèËÆ©Êó∂ÈíüÂèòÊÖ¢Êù•ÂÆûÁé∞‚ÄúÂä†‰∏ÄÁßí‚Äù„ÄÇ</p>
<p>Â§èÊó∂‰ª§ÔºàDaylight Saving Time, DSTÔºâÔºöÂèàÁß∞Êó•ÂÖâËäÇÁ∫¶Êó∂Âà∂ÂíåÂ§è‰ª§Êó∂Èó¥ÔºåÊòØ‰∏ÄÁßç‰∏∫ËäÇÁ∫¶ËÉΩÊ∫êËÄå‰∫∫‰∏∫ËßÑÂÆöÂú∞ÊñπÊó∂Èó¥ÁöÑÂà∂Â∫¶ÔºõÂ§©‰∫ÆÊó©ÁöÑÂ§èÂ≠£‰∫∫‰∏∫Â∞ÜÊó∂Èó¥Ë∞ÉÂø´‰∏ÄÂ∞èÊó∂ÔºåÂèØ‰ª•‰Ωø‰∫∫Êó©Ëµ∑Êó©Áù°ÔºåÂáèÂ∞ëÁÖßÊòéÈáèÔºå‰ª•ÂÖÖÂàÜÂà©Áî®ÂÖâÁÖßËµÑÊ∫êÔºå‰ªéËÄåËäÇÁ∫¶ÁÖßÊòéÁî®ÁîµÔºõÂú®‰∏≠ÂõΩÂπ∂Ê≤°ÊúâÂ§è‰ª§Êó∂Èó¥„ÄÇ</p>
<p>Áî±‰∫é‰ªª‰ΩïÊó∂ÈíüÈÉΩ‰ºöÂá∫Áé∞Ëµ∞‰∏çÂáÜÁöÑÈóÆÈ¢òÔºåÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÊâÄÊúâÊúçÂä°Âô®ÈÉΩ‰ΩøÁî®Êú¨Âú∞Êó∂Èó¥‰∏çÂèØÈÅøÂÖç‰ºöÂá∫Áé∞ËæÉÂ§öÈóÆÈ¢ò„ÄÇ</p>
<h2 id="31-synchronization">3.1. Synchronization</h2>
<p>ÁΩëÁªúÊó∂Èó¥ÂçèËÆÆÔºàNetwork Time Protocol, NTPÔºâÔºö‰Ωú‰∏∫ UTC Âú®‰∫íËÅîÁΩë‰∏≠‰ΩøÁî®ÁöÑ‰∏ÄÁßçÊ†áÂáÜÔºåÊòØ‰∏Ä‰∏™ÂÖ∏ÂûãÁöÑ C/S Êû∂ÊûÑÔºåNTP ÈÄöËøáÁΩëÁªú‰∏çÂÅúÁöÑÁ∫†Ê≠£Â§ö‰∏™ÂÆ¢Êà∑Á´ØÁöÑÊó∂Èó¥ÔºåÁî±‰∫éÁΩëË∑ØÂíå CPU ÁöÑÂª∂ËøüÔºåÂæàÂ§öÊó∂ÂÄô NTP ÂÆ¢Êà∑Á´ØÈúÄË¶ÅËÆ°ÁÆóÂÖ∂Êó∂Èó¥ÂÅèÁßªÈáèÂíåÊù•ÂõûÈÄö‰ø°Âª∂Ëøü„ÄÇ</p>
<p>Êàë‰ª¨ÂÅáËÆæÔºå‰ª•‰∏ã 4 ‰∏™Êó∂Èó¥ËäÇÁÇπÔºö</p>
<ul>
<li>t0ÔºöÂÆ¢Êà∑Á´ØÂèëËµ∑ËØ∑Ê±ÇÁöÑ NTP ÂåÖ</li>
<li>t1ÔºöÊúçÂä°Á´ØÊî∂Âà∞ NTP ÂåÖ</li>
<li>t2ÔºöÊúçÂä°Á´ØÂèëÈÄÅËøîÂõû</li>
<li>t3ÔºöÂÆ¢Êà∑Á´ØÊî∂Âà∞ËøîÂõû</li>
</ul>
<p>ÂÖ∂‰∏≠ÁΩëÁªúÂª∂ËøüÂπ∂‰∏çÂõ∫ÂÆöÔºå‰∏∫‰∫ÜÊõ¥Á≤æÁ°ÆÔºåÂè™ËÉΩÂæóÂà∞ÂæÄËøîÂª∂Ëøü $\delta = (t_3 - t_0) - (t_2 - t_1)$„ÄÇ</p>
<p>NTP ËÆ§‰∏∫ÔºåRTT ÁöÑÂª∂ËøüÈô§‰ª• 2 Âç≥ÊòØ‰∏ÄË∂üÊ∂àÊÅØÁöÑÊó∂Èó¥ÔºåËøô‰∏™Âª∂ËøüÊó∂Èó¥Âä†‰∏ä t2 Âç≥ÂèØÂæóÂà∞ NTP ÂÆ¢Êà∑Á´ØÊó∂Èó¥ÔºåÁß∞‰∏∫ÂÆ¢Êà∑Á´ØÁöÑÊó∂Èó¥ÂÅèÁßªÔºåÁî® $\theta$ Ë°®Á§∫ÔºåÂÖ∂‰∏≠ $\theta = t_2 + \frac{\delta}{2} = \frac{(t_1 - t_0) + (t_2 - t_3)}{2}$„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏äÔºåÂú®ÂÖ∑‰ΩìÂÆûË∑µ‰∏ä‰ºöÊõ¥Âä†Â§çÊùÇÔºåÂæÄÂæÄÈúÄË¶ÅÂÆ¢Êà∑Á´ØÂÆöÊúüËΩÆËØ¢ 3 Âè∞ÁîöËá≥Êõ¥Â§öÁöÑÊúçÂä°Âô®ÔºåÂÅöÁªüËÆ°ÂàÜÊûêÊéíÈô§ÂºÇÂ∏∏ÂÄºÔºåÂú®ÂÖ¨ÂÖ±ÁΩëÁªú‰∏ãËÉΩ‰øùËØÅÂá†ÂçÅÊØ´ÁßíÁöÑËØØÂ∑ÆÔºåËÄåÂú®Â±ÄÂüüÁΩëËÉΩÂ§üÂ∞è‰∫é‰∏ÄÊØ´Áßí„ÄÇ</p>
<p>‰∏ÄËà¨Êù•ËØ¥Ôºå‰∏Ä‰∫õËØ≠Ë®ÄÊàñËÄÖ OS ‰ºöÊèê‰æõ‰∏ÄÁßçÂçïË∞ÉÊó∂ÈíüÔºàMonotonic ClockÔºâÊù•Ëß£ÂÜ≥ÔºåÂ¶Ç</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Code to be timed goes here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">elapsedTime</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">struct</span> <span class="n">timespec</span> <span class="n">tp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nf">clock_gettime</span><span class="p">(</span><span class="n">CLOCK_MONOTONIC</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tp</span><span class="p">);</span> <span class="c1">// ignored error check
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶Ç‰∏äÊñπÊ≥ï‰øùËØÅËé∑ÂèñÂà∞ÁöÑÊó∂Èíü‰∏ÄÂÆöÊòØÂçïË∞ÉÁöÑÔºå‰ΩÜÊòØÂú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÊúâÁùÄÂæàÂ§ßÁöÑÂ±ÄÈôêÊÄß„ÄÇ
ÁâπÂà´Âú∞ÔºåGolang Ê†áÂáÜÂ∫ì‰∏≠Ôºå<code>time.Time</code> ÁöÑÁªìÊûÑÈªòËÆ§ÂåÖÊã¨‰∫Ü <code>hasMonotonic</code> ÈÄâÈ°πÔºåÊÑèÂë≥ÁùÄÂÖ∂‰øùÂ≠ò‰∫Ü <code>CLOCK_REALTIME</code> Âíå <code>CLOCK_MONTONIC</code> ‰∏§‰∏™ÂÄºÔºåÂç≥ÂÆûÈôÖÊó∂Èó¥ÔºàWall TimeÔºâÂíåÂçïË∞ÉÊó∂ÈíüÔºàMonotonic ClockÔºâÔºåÂØπ‰∫éÊµãÈáèÂíåËÆ°ÁÆóÁöÑÊìç‰ΩúÔºåÂùáÈááÁî®ÂçïË∞ÉÊó∂ÈíüÔºå‰∏ç‰ºöÂèóÂà∞ Wall Time ÈáçÁΩÆÁöÑÂΩ±ÂìçÔºåËÄå <code>time.In</code>„ÄÅ<code>time.Local</code> Âíå <code>time.UTC</code> Á≠âÊìç‰ΩúÔºåËøîÂõûÁöÑÂàôÊòØÁúüÂÆûÊó∂Èó¥Ôºå‰ºö‰ªéÁªìÊûú‰∏≠ÂéªÈô§ÂçïË∞ÉÁöÑËØªÊï∞„ÄÇ</p>
<h2 id="32-logical-clock">3.2. Logical Clock</h2>
<p>Lamport ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://lamport.azurewebsites.net/pubs/time-clocks.pdf"  target="_blank" rel="noopener"
    >Time, Clocks, and the Ordering of Events in a Distributed System</a> ÊèêÂá∫‰∫ÜÈÄªËæëÊó∂ÈíüÔºàLogical ClockÔºâÁöÑÊ¶ÇÂøµÔºå‰πüÁß∞‰Ωú Lamport Êó∂Èó¥Êà≥ÔºàLamport TimestampÔºâ„ÄÇ</p>
<p>Áà±Âõ†ÊñØÂù¶Âú®Áã≠‰πâÁõ∏ÂØπËÆ∫ÔºàSpecial RelativityÔºâÁªôÂá∫ÁöÑÊó∂Èó¥ÁöÑÂÆö‰πâÔºöÊó∂Á©∫‰∏≠Ê≤°Êúâ‰∏Ä‰∏™‰∏çÂèòÁöÑ„ÄÅÁ°ÆÂÆöÁöÑÊó∂Èó¥È°∫Â∫èÔºå‰∏çÂêåÁöÑËßÇÂØüËÄÖÂèØËÉΩÂØπ‰∏§‰∏™‰∫ã‰ª∂ÁöÑÈ°∫Â∫èÂêÑÊäíÂ∑±ËßÅ„ÄÇLamport ËøôÈáåÁöÑÈÄªËæëÊó∂ÈíüÂÄüÈâ¥‰∫ÜÁõ∏ÂØπËÆ∫ÁöÑÂÆö‰πâÔºåÂÖ∂ËÆ∫ÊñáÊèèËø∞‰∏∫ &ldquo;One of the mysteries of the universe is that it is possible to construct a system of physical clocks which, running quite independently of one another, will satisfy the Strong Clock Condition. We can therefore use physical clocks to eliminate anomalous behavior.&rdquo;</p>
<p>Lamport ÊèêÂá∫ÔºåÊàë‰ª¨ÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªüÊàñËÆ∏Âπ∂‰∏ç‰∏ÄÂÆöÈúÄË¶Å‰∏Ä‰∏™ÁªùÂØπÁâ©ÁêÜÁöÑÊó∂ÈíüÔºåËÄåÊääÊó∂ÈíüÂÆö‰πâ‰∏∫‚ÄúÂèëÁîüÂú®‰πãÂâç‚ÄùÔºàHappens-BeforeÔºâÁöÑÂÖ≥Á≥ªÔºåÂπ∂‰ΩøÁî®Â¶Ç‰∏ãÂÆö‰πâÔºö</p>
<ol>
<li>a, b ‰∫ã‰ª∂Â±û‰∫é‰∏Ä‰∏™ËøõÁ®ãÔºåÂ¶ÇÊûú a ÂèëÁîüÂÖà‰∫é bÔºåÂàô $a \rightarrow b$</li>
<li>a ÊòØÂèëÈÄÅÊ∂àÊÅØÁöÑ‰∫ã‰ª∂Ôºåb ÊòØÊé•ÂèóÊ∂àÊÅØÁöÑ‰∫ã‰ª∂ÔºåÂàô $a \rightarrow b$</li>
<li>Â¶ÇÊûúÊúâ $a \rightarrow b, b \rightarrow c$ÔºåÂàôÊúâ $a \rightarrow c$</li>
<li>Â¶ÇÊûú‰∫ã‰ª∂ a, b ‰∏çËÉΩÊª°Ë∂≥ $a \rightarrow b$ ÊàñÊòØ $a \rightarrow a$ÔºåÂàôÁß∞ a, b ‰∏§‰∏™‰∫ã‰ª∂ÊòØÂπ∂ÂèëÁöÑÔºåËÆ∞‰∏∫ $a || b$</li>
</ol>
<p>ÈÄªËæëÊó∂ÈíüÊ®°ÂûãÂπ∂‰∏çËÉΩÂæóÂà∞ÂÆåÊï¥ÁöÑÊó∂Èó¥È°∫Â∫èÔºàËøô‰πüÊòØÁõ∏ÊØîÁâ©ÁêÜÊó∂ÈíüÊúÄÂ§ßÁöÑÁº∫ÁÇπÔºâÔºåÈÄªËæëÊó∂Èíü‰∏ãÁöÑ‰∫ã‰ª∂ÊéíÂ∫èÊñπÂºèÂàÜ‰∏∫ÂÖ®Â∫èÂÖ≥Á≥ªÔºàTotal OrderingÔºâÂíåÂÅèÂ∫èÂÖ≥Á≥ªÔºàPartial OrderingÔºâ„ÄÇ‰∏∫‰∫ÜËé∑ÂèñÂà∞Á≥ªÁªüÁöÑÂÖ®Â∫èÂÖ≥Á≥ªÔºåÊàë‰ª¨ÈúÄË¶ÅÂú®ÈÄªËæëÊó∂Èíü‰∏äÂä†‰∏äËøõÁ®ãÂè∑ÔºåÂêåÊó∂ÂÆö‰πâËøõÁ®ãÁöÑÂÖ®Â∫èÂÖ≥Á≥ªÔºåÈªòËÆ§‰ΩøÁî®ÈÄªËæëÊó∂ÈíüÊéíÂ∫è„ÄÇ</p>
<p>Ê≠§Â§ñÔºåÊú¨ÁØáËÆ∫ÊñáËøòÊèêÂá∫‰∫Ü‰∏Ä‰∏™ÈáçË¶ÅÁöÑÊÄùÊÉ≥Ôºö‰ªª‰Ωï‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÈÉΩÂèØ‰ª•Ë¢´ÊèèËø∞‰∏∫‰∏Ä‰∏™ÁâπÂÆöÈ°∫Â∫èÁöÑÁä∂ÊÄÅÊú∫ÔºåÁä∂ÊÄÅÊú∫‰∏ç‰æùËµñ‰∫éÁâ©ÁêÜÊó∂ÈíüÔºåÂèØ‰ª•Áî®Êù•Ëß£ÂÜ≥ÁΩëÁªúÂª∂ËøüÔºåÁΩëÁªúÂàÜÂå∫ÂíåÂÆπÈîôÁ≠âÁ≠âÈóÆÈ¢ò„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏äÔºåPaxos ÁöÑ Ballot„ÄÅRaft ÁÆóÊ≥ïÁöÑ Term ÈÉΩÈááÁî®‰∫ÜÈÄªËæëÊó∂ÈíüÔºàÂéüÊñáÔºöTerms acts as a logical clock in RaftÔºâÁöÑÊÄùÊÉ≥„ÄÇ</p>
<h2 id="33-vector-clock">3.3. Vector Clock</h2>
<p>Colin J. Fidge ÁöÑËÆ∫Êñá <a class="link" href="https://fileadmin.cs.lth.se/cs/Personal/Amr_Ergawy/dist-algos-papers/4.pdf"  target="_blank" rel="noopener"
    >Timestamps in Message-Passing Systems That Preserve the Partial Ordering </a> Âíå Friedemann Mattern ÁöÑËÆ∫Êñá <a class="link" href="http://www.vs.inf.ethz.ch/publ/papers/VirtTimeGlobStates.pdf"  target="_blank" rel="noopener"
    >Virtual Time and Global States of Distributed Systems</a> ÈÉΩÊèêÂá∫‰∫ÜÂêëÈáèÊó∂ÈíüÔºàVector ClockÔºâÁöÑÊ¶ÇÂøµ„ÄÇÁõ∏ÂØπ‰∫éÈÄªËæëÊó∂ÈíüÔºåÂè™ÊúâÊØè‰∏™ËøõÁ®ãÁü•ÈÅìËá™Â∑±ÁöÑÊó∂ÈíüÔºåÊ≤°ÊúâÂÖ∂‰ªñËøõÁ®ãÁöÑÊó∂ÈíüÔºå‰ªéËÄåÂØºËá¥ÈÄöËøáÈÄªËæëÊó∂ÈíüÊó†Ê≥ïËÆ°ÁÆóÂá∫Êüê‰∫õ‰∫ã‰ª∂ÔºåÂøÖÈ°ªÊåáÂÆöÂè¶‰∏Ä‰∏™ËøõÁ®ãÁöÑ‰ºòÂÖàÁ∫ß„ÄÇ</p>
<p>ÂêëÈáèÊó∂ÈíüÁöÑÊØè‰∏™ËøõÁ®ãÈÉΩÂåÖÂê´‰∫ÜÊï¥‰∏™Á≥ªÁªüÁöÑÊó∂ÈíüÔºåËøôÊ†∑Â∞±Êó†ÈúÄÊåáÂÆöÂÖ∂‰ªñËøõÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÔºåÂèØ‰ª•Áî®‰∫éÂÜ≤Á™ÅÂú∫ÊôØÁöÑÊ£ÄÊµã„ÄÇ</p>
<p>Âú® N ‰∏™ËäÇÁÇπÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÊØè‰∏™Êó∂ÈíüÁöÑÊï∞ÊçÆÁªìÊûÑÈÉΩÊòØ‰∏Ä‰∏™ N Áª¥ÂêëÈáèÔºåË°®Á§∫‰∏∫ $V_0, V_1, &hellip;, V_{N-1}$ÔºåÂÖ∂‰∏≠Á¨¨ i ‰∏™ËäÇÁÇπÁöÑÊó∂ÈíüË°®Á§∫‰∏∫ $(V_{i}[0], V_{i}[1], &hellip;, V_{i}[N-1])$ÔºåÂÖ∂‰∏≠ $V_{i}[i]$ ‰ª£Ë°®ËøõÁ®ãËá™Â∑±ÁöÑÊó∂Èíü„ÄÇÁõ∏ÊØî‰∫éÈÄªËæëÊó∂ÈíüÔºåÂêëÈáèÊó∂ÈíüÈúÄË¶ÅÈáçÊñ∞Êõ¥Êñ∞Êú¨Âú∞ËÆ∞ÂΩïÊâÄÊúâÁöÑËäÇÁÇπÁöÑÂêëÈáèÁöÑÊó∂Èíü„ÄÇÂêëÈáèÊó∂ÈíüÁöÑÊõ¥Êñ∞ÈÄªËæë‰∏∫Ôºö</p>
<ol>
<li>ÊâÄÊúâËøõÁ®ãÁöÑÂêëÈáèÊó∂ÈíüÁöÑÂàùÂßãÂÄºÈÉΩËÆæÁΩÆ‰∏∫ 0</li>
<li>ÂΩìËøõÁ®ã a ÂèëÁîü‰∏Ä‰∏™‰∫ã‰ª∂ÔºåÂàô $V_{a}[a] = V_{a}[a] + 1$</li>
<li>ËøõÁ®ã a Âêë b ÂèëÈÄÅÊ∂àÊÅØÔºåa ÂÖà‰ºö $V_{a}[a] = V_{a}[a] + 1$ÔºåÂÜçÊääËá™Â∑±Êú¨Âú∞ÁöÑ $V_a$ ÂèëÁªô bÔºåb ÂÜçËøõË°åÊìç‰Ωú $ V_{b}[i] = Max(V_{a}[i], V_{b}[i]), (i \in [0, N-1]) $</li>
</ol>
<p>ÂØπ‰∫éÂêëÈáèÊó∂ÈíüÔºåÂà§Êñ≠‚ÄúÂèëÁîüÂú®‰πãÂâç‚ÄùÁöÑÂÖÖË¶ÅÊù°‰ª∂‰∏∫Ôºö</p>
<ul>
<li>$(\forall i \in [0, N-1], V_{a}[i] \le V_{b}[i]) \wedge (\exist j \in [0, N-1], V_{a}[j] \lt V_{b}[j]) \Leftrightarrow a \rightarrow b$</li>
</ul>
<p>Ê≠§Â§ñÔºåÂú®ÂàÜÂ∏ÉÂºèÂ≠òÂÇ®È¢ÜÂüüÔºåËøòÊúâ‰∏Ä‰∏™ÁÆóÊ≥ïÁß∞‰πã‰∏∫ÁâàÊú¨ÂêëÈáèÔºàVersion VectorÔºâÔºåÂÖ∂ÊÄùÊÉ≥‰∏éÂêëÈáèÊó∂ÈíüÈùûÂ∏∏Áõ∏‰ººÔºå‰∏çËøáÂÖ∂Ê≤°ÊúâËÆ∞ÂΩïÊØè‰∏™‰∫ã‰ª∂ÁöÑÂêëÈáèÊó∂ÈíüÔºåÂè™ÂÖ≥ÂøÉÊîπÂèò‰∫ÜÊï∞ÊçÆÂâØÊú¨ÁöÑ‰∫ã‰ª∂„ÄÇ</p>
<ol>
<li>ÊØè‰∏™ËøõÁ®ãÁöÑÁâàÊú¨ÂêëÈáèÁöÑÂàùÂßãÂÄºÈÉΩËÆæÁΩÆ‰∏∫ 0</li>
<li>ÂΩìËøõÁ®ã a ÂèëÁîüÊõ¥Êñ∞‰∫ã‰ª∂ÁöÑÊó∂ÂÄôÔºå$V_{i}[i] = V_{i}[i] + 1$</li>
<li>ÂΩì a, b ‰∏§‰∏™ËøõÁ®ãÊ∂àÊÅØÈÄö‰ø°ÁöÑÊó∂ÂÄôÔºå$ V_{a}[i] = V_{b}[i] = Max(V_{a}[i], V_{b}[i]), (i \in [0, N-1]) $</li>
</ol>
<p>Áõ∏ÂØπ‰∫éÂêëÈáèÊó∂ÈíüÔºåÁâàÊú¨ÂêëÈáèÂè™Âú®Êõ¥Êñ∞Êìç‰Ωú‰ºöÂ¢ûÂä†Êó∂ÈíüÔºå‰∏îÊî∂ÂèëÂèåÊñπÈÉΩË¶ÅÂØπÂêëÈáèËøõË°åÂêåÊ≠•„ÄÇÂØπ‰∫éÂ≠òÂÇ®Â∫îÁî®ÔºåÊØè‰∏™Êï∞ÊçÆÈ°πÈÉΩÂØπÂ∫î‰∏Ä‰∏™ÁâàÊú¨ÔºåÁΩëÁªúÂàÜÂå∫Êó∂Ôºå‰∏çÂêåÁöÑÁâàÊú¨ÂêëÈáèÂèØ‰ª•Â∏ÆÂä©ÂÆ¢Êà∑Á´ØËØÜÂà´ÈúÄË¶ÅËß£ÂÜ≥ÁöÑÂÜ≤Á™ÅÊï∞ÊçÆ„ÄÇ‰ΩÜÊòØÂÖ∂Áº∫ÁÇπÊòØÈöèÁùÄÂêëÈáèÁª¥Â∫¶ÂæàÂ§ßÔºåÈúÄË¶ÅÂæàÂ§ßÁöÑÂ≠òÂÇ®Á©∫Èó¥ÔºåÊØîËæÉÁöÑÊó∂Èó¥‰πüÂæàÈïø„ÄÇ</p>
<h1 id="4-distributed-data">4. Distributed Data</h1>
<blockquote>
<p><a class="link" href="https://www.cgl.ucsf.edu/Outreach/pc204/NoSilverBullet.html"  target="_blank" rel="noopener"
    >No Silver Bullet: Essence and Accidents of Software Engineering</a></p>
</blockquote>
<h2 id="41-partitioning">4.1. Partitioning</h2>
<ul>
<li>ÂûÇÁõ¥ÂàÜÂå∫ÔºàVertical PartitioningÔºâÔºöÂØπÂàóË°®ËøõË°åÊãÜÂàÜÔºåÂ∞ÜÊüê‰∫õÂàóÊãÜÂà∞ÁâπÂÆöÁöÑÂàÜÂå∫ÔºåÂ¶ÇÂ∞Ü TEXT ÊàñËÄÖ BLOB Á±ªÂûãÁöÑÊîæÂú®ÂçïÁã¨ÁöÑË°®‰∏≠Ôºå‰øùËØÅÂÆåÊï¥ÊÄßÂπ∂ÊèêÈ´òÊÄßËÉΩ„ÄÇ</li>
<li>Ê∞¥Âπ≥ÂàÜÂå∫ÔºàHorizontal PartitioningÔºâÔºö‰πüÁß∞‰∏∫ÂàÜÁâáÔºàShardingÔºâÔºåÂç≥ÂØπË°åËøõË°åÊãÜÂàÜÔºå‰∏çÂêåÁöÑË°åÊîæÂÖ•‰∏çÂêåÁöÑË°®‰∏≠ÔºåÊâÄÊúâË°®ÁöÑÂÆö‰πâÂú®ÊØè‰∏™ÂàÜÂå∫‰∏≠ÈÉΩËÉΩÊâæÂà∞„ÄÇ</li>
</ul>
<p>ÂØπ‰∫éÊ∞¥Âπ≥ÂàÜÂå∫Ôºå‰∏ªË¶ÅÊúâ‰ª•‰∏ãÂàÜÂå∫Á≠ñÁï•Ôºö</p>
<ol>
<li>ËåÉÂõ¥ÂàÜÂå∫ÔºàRange PartitioningÔºâÔºöÊ†πÊçÆÂÖ≥ÈîÆÂ≠óÊù•Â∞ÜÊï∞ÊçÆÈõÜÊãÜÂàÜ‰∏∫Â§ö‰∏™ËåÉÂõ¥</li>
</ol>
<ul>
<li>‰ºòÁÇπÔºöÂÆûÁé∞ÁÆÄÂçïÔºåËÉΩÁî®ÂÖ≥ÈîÆÂ≠óËåÉÂõ¥Êü•ËØ¢ÔºåÊñπ‰æø‰øÆÊîπËåÉÂõ¥ÂÆûÁé∞Êï∞ÊçÆÁöÑÂ¢ûÂä†ÊàñÂáèÂ∞ë</li>
<li>Áº∫ÁÇπÔºöÊó†Ê≥ïÂØπÂàÜÂå∫‰ª•Â§ñÁöÑÈîÆËøõË°åÂÖ≥ÈîÆÂ≠óÊü•ËØ¢Ôºå‰∏îÊü•ËØ¢ËåÉÂõ¥ËæÉÂ§ß‰∏î‰Ωç‰∫éÂ§ö‰∏™ËäÇÁÇπÊòØÊÄßËÉΩËæÉÂ∑ÆÔºåÊï∞ÊçÆÂàÜÂ∏É‰∏çÂùáÂåÄÔºåÂÆπÊòìÈÄ†ÊàêÂ∞æÈÉ®ÁÉ≠ÁÇπÊïàÂ∫î</li>
</ul>
<ol start="2">
<li>
<p>ÂìàÂ∏åÂàÜÂå∫ÔºàHash PartitioningÔºâÔºöÂ∞ÜÂìàÂ∏åÂÄºÁî®‰∫éÂàÜÂå∫Ôºå‰ΩøÂæóÂàÜÂå∫Áõ∏ÂØπÂùáÂåÄÔºõ‰ΩÜÊòØÊó†Ê≥ïÂÆûÁé∞ËåÉÂõ¥Êü•ËØ¢Ôºå‰∏î‰∏çÊòìÂ¢ûÂáèËäÇÁÇπ</p>
</li>
<li>
<p>‰∏ÄËá¥ÊÄßÂìàÂ∏åÔºàConsistent HashingÔºâÔºöÂ∞ÜÊï¥‰∏™ÂìàÂ∏åÁªÑÁªáÊäΩË±°Êàê‰∏Ä‰∏™ÁéØÔºåÊï∞ÊçÆÂàÜÂå∫Âà∞ÁöÑËäÇÁÇπ‰∏∫ÊåâÈ°∫Êó∂ÈíàÈÅáËßÅÁöÑÁ¨¨‰∏Ä‰∏™ËäÇÁÇπ‰∏ä„ÄÇÂΩìÁ≥ªÁªüËäÇÁÇπÂ§™Â∞ëÊó∂Ôºå‰∏Ä‰∏™ËäÇÁÇπ‰∏ãÁ∫ø‰ºöÁªô‰∏ã‰∏Ä‰∏™È°∫Êó∂ÈíàÊñπÂêë‰∏äÁöÑËäÇÁÇπÂ¢ûÂä†Â§ßÈáèÁöÑÊï∞ÊçÆÔºåÂèØ‰ª•ÈÄöËøáËôöÊãüËäÇÁÇπÔºàVirtual NodeÔºâÊñπÊ°àËß£ÂÜ≥ÔºåÂΩì‰∏Ä‰∏™ËäÇÁÇπÂ§±ÊïàÊàñÊñ∞ÁöÑËäÇÁÇπÂä†ÂÖ•Êó∂ÔºåÂè™ÈúÄË¶ÅÈáçÊñ∞Êò†Â∞ÑÂÆÉÊâÄÂØπÂ∫îÁöÑËôöÊãüËäÇÁÇπÔºåËÄå‰∏çÈúÄË¶ÅÈáçÊñ∞Êò†Â∞ÑÊâÄÊúâÁöÑÊï∞ÊçÆÔºå‰ªéËÄåÂáèÂ∞ë‰∫ÜÊï∞ÊçÆËøÅÁßªÁöÑÊàêÊú¨„ÄÇÊ≠§Â§ñÔºåÈÄöËøáËôöÊãüËäÇÁÇπËøòÂèØ‰ª•ÂàªÊÑèËÆ©Êï∞ÊçÆ‰∫ßÁîüÂÅèÊñúÔºåÂ¶ÇËÆ©Êõ¥Â•ΩÁöÑÊú∫Âô®ÊâøËΩΩÊõ¥Â§öÁöÑÊï∞ÊçÆÁ≠â„ÄÇ</p>
</li>
</ol>
<h2 id="42-replication">4.2. Replication</h2>
<p>‰∏∫‰∫ÜÈ´òÂèØÁî®ÔºåÈô§‰∫ÜÂàÜÂå∫‰ª•Â§ñËøòÂèØ‰ª•‰ΩøÁî®Â§çÂà∂ÊäÄÊúØÔºåÊèêÈ´òÊï∞ÊçÆÁöÑÂèØÁî®ÊÄßÂíåÂÆâÂÖ®ÊÄßÔºåÈÄöËøáÂ§öÂú∞Êï∞ÊçÆ‰∏≠ÂøÉÂèØ‰ª•ÂáèÂ∞ëÂæÄËøîÊó∂Èó¥ÔºàRTTÔºâÔºåÂ¢ûÂä†ÂêûÂêêÈáè„ÄÇ</p>
<blockquote>
<p>Âçï‰∏ªÂ§çÂà∂</p>
</blockquote>
<p>ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÈÉΩËµ∞Âà∞‰∏ªËäÇÁÇπÔºåÂÖ∂‰ΩôÂâØÊú¨ÈÉΩÊòØ‰ªéËäÇÁÇπÔºàFollower or SlaveÔºâÔºå‰ªéËäÇÁÇπË¥üË¥£ËØªËØ∑Ê±ÇÔºåÂπ∂‰∏é‰∏ªËäÇÁÇπÂêåÊ≠•ÊúÄÊñ∞ÁöÑÊï∞ÊçÆ„ÄÇÂÖ∂‰∏≠ÁöÑÂêåÊ≠•ÊñπÂºè‰πüÂèØÂàÜ‰∏∫Â¶Ç‰∏ã‰∏âÁßç</p>
<ol>
<li>ÂêåÊ≠•Â§çÂà∂ÔºàSynchronous ReplicationÔºâÔºöÊâÄÊúâ‰ªéËäÇÁÇπÈÉΩÂÜôÂÆåÊàêÂêéÊâçËøîÂõûÂÆ¢Êà∑Á´ØÊàêÂäü</li>
<li>ÂºÇÊ≠•Â§çÂà∂ÔºàAsynchronous ReplicationÔºâÔºö‰∏ªËäÇÁÇπÂÆåÊàêËØ∑Ê±ÇÂêéÔºåÁ´ãÂç≥ÂëäËØâÂÆ¢Êà∑Á´ØÊàêÂäü</li>
<li>ÂçäÂêåÊ≠•Â§çÂà∂ÔºàSemisynchronous ReplicationÔºâÔºöÂè™ÈúÄÁ≠âÂæÖËá≥Â∞ë‰∏Ä‰∏™‰ªéËäÇÁÇπÂÜôÂÖ•ÊàêÂäüÂêéÂç≥ÂèØËøîÂõû</li>
</ol>
<ul>
<li>‰ºòÁÇπÔºöÁÆÄÂçïÊòì‰∫éÂÆûÁé∞ÔºåÈÄöËøáÊãìÂ±ï‰ªéËäÇÁÇπÂèØ‰ª•ÊèêÈ´òËØªÊÄßËÉΩÔºå‰ªÖ‰ªÖÈúÄË¶ÅÂØπ‰∏ªËäÇÁÇπËøõË°åÂπ∂ÂèëÊìç‰ΩúÔºåÈÅøÂÖç‰∫ÜÂ§ÑÁêÜ‰ªéËäÇÁÇπ‰πãÈó¥ÂÜ≤Á™ÅÁöÑÈóÆÈ¢òÔºåÈÄÇÁî®‰∫éÂàÜÂ∏ÉÂºè‰∫ãÂä°„ÄÇ</li>
<li>Áº∫ÁÇπÔºö‰∏ªËäÇÁÇπÂæàÂèØËÉΩÈÄ†ÊàêÊÄßËÉΩÁì∂È¢àÔºå‰∏ªËäÇÁÇπÂÆïÊú∫Êó∂Ôºå‰ªéËäÇÁÇπÈÄâ‰∏ª‰∏çÊòØÂÆûÊó∂ÁöÑÔºåÂèØËÉΩÈÄ†ÊàêÁü≠ÊöÇÁöÑÂÅúÊú∫ÔºåÂèØËÉΩÂá∫Áé∞ËÑëË£ÇÔºàSplit BrainÔºâÈóÆÈ¢òÈÄ†ÊàêÊï∞ÊçÆÊçüÂùè„ÄÇ</li>
</ul>
<blockquote>
<p>Â§ö‰∏ªÂ§çÂà∂</p>
</blockquote>
<p>Â§ö‰∏™ËäÇÁÇπÈÉΩÂèØ‰ª•Êé•ÂèóÂÜôËØ∑Ê±ÇÔºåËøôÊÑèÂë≥ÁùÄÂØπ‰∏éËØ∑Ê±ÇÁöÑÈ°∫Â∫èÂèØËÉΩÈÄ†ÊàêÂàÜÊ≠ßÈÄ†ÊàêÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÔºàÊï∞ÊçÆÂÜ≤Á™ÅÂú®Âçï‰∏ªÂ§çÂà∂‰πü‰ºöÂá∫Áé∞Ôºå‰ΩÜÊòØÂæÄÂæÄÁî®‰∏ªËäÇÁÇπ‰Ωú‰∏∫ÊúÄÁªàÊï∞ÊçÆÔºåÂ§ÑÁêÜÂπ∂‰∏çÂ§çÊùÇÔºâ„ÄÇ‰∏ÄËà¨ÂèØ‰ª•ËÆ©ÂÆ¢Êà∑Á´ØÈÄâÊã©Â¶Ç‰ΩïËß£ÂÜ≥ÂÜ≤Á™Å„ÄÅÊúÄÂêéÂÜôÂÖ•ËÉúÂà©ÔºàLWW, Last Write WinsÔºâ„ÄÅÂõ†ÊûúÂÖ≥Á≥ªË∑üË∏™ÔºàHappens BeforeÔºâÁ≠âÊâãÊÆµËß£ÂÜ≥„ÄÇ</p>
<ul>
<li>‰ºòÁÇπÔºöÂ¢ûÂä†‰∫Ü‰∏ªËäÇÁÇπÁöÑÂÆπÈîôÊÄßÔºåÂèØ‰ª•ÂàÜÊãÖÂÜôË¥üËΩΩÔºåÂèØ‰ª•Ë∑ØÁî±Âà∞‰∏çÂêå‰∏ªËäÇÁÇπÊèêÈ´òÈÄüÂ∫¶</li>
<li>Áº∫ÁÇπÔºöËß£ÂÜ≥Êï∞ÊçÆÂÜ≤Á™ÅÂ∏¶Êù•‰∫ÜÂ§çÊùÇÊÄßÔºåËäÇÁÇπÂ¢ûÂä†Â§çÊùÇ</li>
</ul>
<p>‰∏ÄËà¨Êù•ËØ¥ÔºåÂ§ö‰∏ªÂ§çÂà∂Êï∞ÊçÆÂÜ≤Á™ÅÁöÑÂ§çÊùÇÊÄßËøúËøúÂ§ß‰∫éÂÖ∂‰ºòÁÇπÔºå‰∏ÄËà¨Âè™Áî®‰∫éÈÅøÂÖçË∑®Êï∞ÊçÆ‰∏≠ÂøÉÁöÑÂÜôËØ∑Ê±ÇÊìç‰ΩúÔºåË∑ØÁî±Âà∞Âú∞ÁêÜ‰ΩçÁΩÆÊõ¥ËøëÁöÑ‰∏≠ÂøÉÊèêÂçáÂÜôÊÄßËÉΩ„ÄÇ</p>
<blockquote>
<p>Êó†‰∏ªÂ§çÂà∂</p>
</blockquote>
<p>ËÆ©ÂÆ¢Êà∑ÂÜôËØ∑Ê±ÇÂèëÈÄÅÂà∞Â§ö‰∏™ËäÇÁÇπÔºå‰∏ÄÊó¶ÂæóÂà∞‰∏ÄÈÉ®ÂàÜÁöÑÊàêÂäüÁõ∏Â∫îÔºåÂç≥ÂèØÂà§Êñ≠ËøôÊ¨°ËØ∑Ê±ÇÊàêÂäü‰∫Ü„ÄÇÂÆ¢Êà∑ÁöÑËØªËØ∑Ê±Ç‰πüÂèëÂà∞ÂæàÂ§öÁöÑËäÇÁÇπÔºåËé∑ÂèñÊï∞ÊçÆÂíåÊï∞ÊçÆÁöÑÁâàÊú¨Âè∑ÔºåÂØπÊØîÂÜ≥ÂÆö‰ΩøÁî®Âì™‰∏™Êï∞ÊçÆ„ÄÇÊ≠§Â§ñÔºå‰∏∫‰∫ÜËÆ©Á≥ªÁªüËÉΩÂ§ü‰øÆÂ§çÊóßÊï∞ÊçÆÁöÑ‰∏ç‰∏ÄËá¥ÔºåËøòÈúÄË¶Å‰ΩøÁî®‰∏ÄËß£ÂÜ≥ÊñπÊ°àÔºåËøôÈáå‰ª• Dynamo Êû∂ÊûÑÔºà<a class="link" href="https://javawithloveblog.wordpress.com/2019/12/09/dynamo-style-db/"  target="_blank" rel="noopener"
    >Dynamo-Style</a>Ôºâ‰∏∫‰æã</p>
<ol>
<li>ËØª‰øÆÂ§çÔºàRead RepairÔºâÔºöÂÆ¢Êà∑Á´ØË¥üË¥£Êõ¥Êñ∞Êï∞ÊçÆÔºåÊ£ÄÊµãÂà∞ÊóßÊï∞ÊçÆÂêéÔºåÈ°∫‰æøÂèëÈÄÅÂÜôËØ∑Ê±ÇÂà∞ÊóßÊï∞ÊçÆÊâÄÂú®ÁöÑËäÇÁÇπ</li>
<li>ÂèçÁÜµËøáÁ®ãÔºàAnti-Entropy ProcessÔºâÔºöÂª∫Á´ã‰∏Ä‰∏™ÂêéÂè∞ËøõÁ®ãÊù•‰øÆÂ§çÊï∞ÊçÆÔºåËøõÁ®ãÊâæÂá∫ÈîôËØØÁöÑÊï∞ÊçÆÔºåÂπ∂‰ªéÂ≠òÂÇ®‰∫ÜÊúÄÊñ∞ÁöÑÊï∞ÊçÆÁöÑËäÇÁÇπÊù•Â∞ÜÊï∞ÊçÆÂ§çÂà∂Âà∞ÈîôËØØÁöÑËäÇÁÇπÔºå‰∏ç‰øùËØÅÂÜôÁöÑÈ°∫Â∫èÔºåÂè™‰øùËØÅÊúÄÁªàÁöÑ‰∏ÄËá¥„ÄÇÂ¶Ç‰ΩøÁî® <a class="link" href="https://en.wikipedia.org/wiki/Merkle_tree"  target="_blank" rel="noopener"
    >Merkle Tree</a>Ôºå‰πüÁß∞ÂìàÂ∏åÊ†ëÔºàHash TreeÔºâÊù•È™åËØÅÊï∞ÊçÆÊòØÂê¶‰∏ÄËá¥ÔºåÂ∞ÜÊï∞ÊçÆÊåâÂÖ≥ÈîÆÂ≠óÂàíÂàÜËåÉÂõ¥ÔºåÊØè‰∏™ËåÉÂõ¥ËÆ°ÁÆóÂá∫‰∏Ä‰∏™ÂìàÂ∏åÂÄº‰Ωú‰∏∫Âè∂Â≠êËäÇÁÇπÔºåÁÑ∂ÂêéËá™Â∫ïÂêë‰∏äÂêàÂπ∂ÊàêÊï¥‰∏™Ê†ëÔºåÂ¶ÇÊûú‰∏§‰∏™Ê†ëÁöÑÊ†πËäÇÁÇπÁõ∏ÂêåÔºåÂàô‰øùËØÅ‰∫ÜÂè∂Â≠êËäÇÁÇπ‰πüÁõ∏ÂêåÔºåÂàô‰∏çÈúÄË¶ÅÂÜçÊ£ÄÊü•ÔºåÂ¶ÇÊûúÊ†πËäÇÁÇπ‰∏çÂêåÔºåÂÜçÂæÄÂ≠êËäÇÁÇπ‰∏≠Êü•ÊâæÔºåÁõ¥Ëá≥ÂèëÁé∞‰∏çÂêå„ÄÇ</li>
</ol>
<p><a class="link" href="https://en.wikipedia.org/wiki/Quorum_%28distributed_computing%29#:~:text=A%20quorum%20is%20the%20minimum,operation%20in%20a%20distributed%20system."  target="_blank" rel="noopener"
    >Ê≥ïÂÆö‰∫∫Êï∞ÔºàQuorumÔºâÊú∫Âà∂</a>ÔºöÁî®‰∫é‰øùËØÅÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÁöÑÊï∞ÊçÆÂÜó‰ΩôÂíåÊúÄÁªà‰∏ÄËá¥ÊÄßÔºåÁî®‰∫éÂ§öÂâØÊú¨Êï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄßÁª¥Êä§„ÄÇÂú®‰∏Ä‰∏™ N ‰∏™ËäÇÁÇπÁªÑÊàêÁöÑÁ≥ªÁªü‰∏≠ÔºåË¶ÅÊ±ÇËá≥Â∞ë W ‰∏™ËäÇÁÇπÂÜôÊàêÂäüÔºå‰∏îÂêåÊó∂‰ªé R ‰∏™ËäÇÁÇπ‰∏≠ËØªÂèñÊï∞ÊçÆÔºåÂè™Ë¶Å‰øùËØÅ W + R &gt; N &amp;&amp; W &gt; N/2ÔºåÂç≥ÂèØ‰øùËØÅ R ‰∏™ËøîÂõûÂÄº‰∏≠‰∏ÄÂÆöÊúâÊúÄÊñ∞ÁöÑÊï∞ÊçÆÔºåÂÖ∂‰∏≠ÁöÑ W &gt; N/2 ‰øùËØÅ‰∫ÜÊï∞ÊçÆÁöÑ‰∏≤Ë°åÂåñ‰øÆÊîπÔºå‰∏çËÉΩÊúâ‰∏§‰∏™ÂÜôËØ∑Ê±ÇÂêåÊó∂‰øÆÊîπ‰∏Ä‰ªΩÊï∞ÊçÆ„ÄÇËøô‰∏™Êú∫Âà∂Âú®Â∑•Á®ã‰∏äÁöÑÂÆûË∑µÂèØ‰ª•Âú®ËØªÂÜôÊÄßËÉΩ‰∏äË∞ÉËäÇÂèÇÊï∞Ôºå‰ª•ÈÄÇÈÖçÊõ¥Â•ΩÁöÑËØªÂÜôË¥üËΩΩ„ÄÇ</p>
<h2 id="43-cap-theorem">4.3. CAP Theorem</h2>
<p><a class="link" href="https://en.wikipedia.org/wiki/CAP_theorem"  target="_blank" rel="noopener"
    >CAP ÂÆöÁêÜ</a>Ôºå‰πüÁß∞‰∏∫Â∏ÉÈ≤ÅÂ∞îÂÆöÁêÜÔºàBrewer&rsquo;s TheoremÔºâÔºåÊåáÂá∫Âú®‰∏Ä‰∏™ÂºÇÊ≠•ÁΩëÁªúÁéØÂ¢É‰∏≠ÔºåÂØπ‰∫é‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèËØªÂÜôÁöÑÂ≠òÂÇ®Á≥ªÁªüÔºàRead-Write Storage SystemÔºâÔºåÂè™ËÉΩÊª°Ë∂≥‰∏ÄËá¥ÊÄßÔºàConsistency, <code>C</code>Ôºâ„ÄÅÂèØÁî®ÊÄßÔºàAvailability, <code>A</code>Ôºâ„ÄÅÂàÜÂå∫ÂÆπÈîôÊÄßÔºàPartition Tolerance, <code>P</code>Ôºâ‰∏âËÄÖ‰∏≠ÁöÑ‰∏§‰∏™„ÄÇ</p>
<p><a class="link" href="https://en.wikipedia.org/wiki/PACELC_theorem"  target="_blank" rel="noopener"
    >PACELC ÂÆöÁêÜ</a>ÔºåÊåáÂá∫Âú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÂ≠òÂú®ÁΩëÁªúÂàÜÂå∫ÔºàPartition, <code>P</code>ÔºâÁöÑÊÉÖÂÜµ‰∏ãÔºåÂøÖÈ°ªÂú®ÂèØÁî®ÊÄßÔºàAvailability, <code>A</code>ÔºâÂíå‰∏ÄËá¥ÊÄßÔºàConsistency, <code>C</code>Ôºâ‰∏≠ÂÅöÂá∫ÈÄâÊã©ÔºõÂê¶ÂàôÔºàElse, <code>E</code>ÔºâÔºåÁ≥ªÁªüÂú®Ê≤°ÊúâÁΩëÁªúÂàÜÂå∫‰∏îÊ≠£Â∏∏ËøêË°åÁöÑÊÉÖÂÜµ‰∏ãÔºåÂøÖÈ°ªÂú®Âª∂ËøüÔºàLatency, <code>L</code>ÔºâÂíå‰∏ÄËá¥ÊÄßÔºàConsistency, <code>C</code>Ôºâ‰πãÈó¥ÂÅöÂá∫ÈÄâÊã©„ÄÇ</p>
<p>BASEÔºàBasically Available, Soft State, Eventually ConsistentÔºâÔºöDan Pritchett Âú®ËÆ∫Êñá <a class="link" href="https://queue.acm.org/detail.cfm?id=1394128"  target="_blank" rel="noopener"
    >Base: An Acid Alternative
</a> ÊèêÂá∫ÔºåBASE ÊòØÂü∫Êú¨ÂèØÁî®„ÄÅËΩØÁä∂ÊÄÅ„ÄÅÊúÄÁªà‰∏ÄËá¥ÁöÑÁÆÄÂÜô„ÄÇÊåáÂá∫Â≠òÂú®ÁΩëÁªúÂàÜÂå∫ÁöÑÊÉÖÂÜµÔºå‰∏∫‰∫ÜÈ´òÂèØÁî®ÔºåÂèØ‰ª•ÊöÇÊó∂Áâ∫Áâ≤Âº∫‰∏ÄËá¥ÔºåÈÄâÊã©Êõ¥Âº±ÁöÑÊúÄÁªà‰∏ÄËá¥ÊÄß„ÄÇÂ¶ÇÁªèÂÖ∏ÁöÑÁºìÂ≠ò‰∏ÄËá¥ÊÄßÈóÆÈ¢òËß£ÂÜ≥ÊñπÊ°à <a class="link" href="https://learn.microsoft.com/en-us/azure/architecture/patterns/cache-aside"  target="_blank" rel="noopener"
    >Cache-Aside Pattern</a> Â∞±ÊòØÈááÁî®ÁöÑ BASE„ÄÇ</p>
<h2 id="44-consistency-model">4.4. Consistency Model</h2>
<blockquote>
<p>Á∫øÊÄß‰∏ÄËá¥ÊÄßÔºàLinearizable Consistency or LinearizabilityÔºâ</p>
</blockquote>
<p>‰πüÁß∞‰∏∫Âº∫‰∏ÄËá¥ÊÄßÔºàStrong ConsistencyÔºâÔºå‰∏•Ê†º‰∏ÄËá¥ÊÄßÔºàStrict ConsistencyÔºâÔºåÂéüÂ≠ê‰∏ÄËá¥ÊÄßÔºàAtomic ConsistencyÔºâÔºåÁ´ãÂç≥‰∏ÄËá¥ÊÄßÔºàImmediate ConsistencyÔºâÊàñËÄÖÂ§ñÈÉ®‰∏ÄËá¥ÊÄßÔºàExternal ConsistencyÔºâ„ÄÇ</p>
<p>‰∏•Ê†ºÂÆö‰πâÔºöÁªôÂÆö‰∏Ä‰∏™ÊâßË°åÁöÑÂéÜÂè≤ÔºåÊâßË°åÂéÜÂè≤Ê†πÊçÆÂπ∂ÂèëÊìç‰ΩúÂèØ‰ª•ÊãìÂ±ï‰∏∫Â§ö‰∏™È°∫Â∫èÂéÜÂè≤ÔºàSequential HistoryÔºâÔºåÂè™Ë¶Å‰ªé‰∏≠ÊâæÂà∞‰∏Ä‰∏™ÂêàÊ≥ïÁöÑÂéÜÂè≤ÔºåÂ∞±ËØ¥ÊòéËØ•ÊâßË°åÂéÜÂè≤ÊòØÁ∫øÊÄß‰∏ÄËá¥ÁöÑ„ÄÇ</p>
<p>Á∫øÊÄß‰∏ÄËá¥ÊÄßÊåáÁöÑÂ∞±ÊòØ CAP ÂÆöÁêÜ‰∏≠ÁöÑ‰∏ÄËá¥ÊÄßÔºå‰πüÊòØÊúÄÂº∫ÁöÑ‰∏ÄËá¥ÊÄßÊ®°ÂûãÔºåÂæÄÂæÄÈúÄË¶ÅÈÄöËøáÂÖ±ËØÜÁÆóÊ≥ïÊù•ÂÆûÁé∞ÔºåÂåÖÊã¨Â¶Ç‰ΩïÈÄâÂèñÈ¢ÜÂØºËÄÖÔºåÂ¶Ç‰ΩïÂ§ÑÁêÜÈáçÂ§çËØ∑Ê±ÇÁ≠âÔºõÂÆûÁé∞Á∫øÊÄß‰∏ÄËá¥ÊÄßÈúÄË¶ÅËä±Ë¥πÂæàÂ§ßÁöÑ‰ª£‰ª∑ÔºåÂêåÊ≠•ÂéüËØ≠ÂíåÂéüÂ≠êÂèòÈáèÁ≠âÈÉΩ‰ºöÂ¢ûÂä†Á≥ªÁªüÂºÄÈîÄ„ÄÇ</p>
<blockquote>
<p>È°∫Â∫è‰∏ÄËá¥ÊÄßÔºàSequential ConsistencyÔºâ</p>
</blockquote>
<p>Ë¶ÅÊ±ÇÂêå‰∏Ä‰∏™ÂÆ¢Êà∑Á´ØÁöÑÊìç‰ΩúÂú®ÊéíÂ∫èÂêéÁöÑÂÖàÂêéÈ°∫Â∫è‰∏çÂèòÔºå‰∏çÂêåÂÆ¢Êà∑Á´Ø‰πãÈó¥ÁöÑÂÖàÂêéÈ°∫Â∫èÊòØÂèØ‰ª•‰ªªÊÑèÊîπÂèòÁöÑ„ÄÇÈ°∫Â∫è‰∏ÄËá¥‰∏éÁ∫øÊÄß‰∏ÄËá¥ÁöÑ‰∏ªË¶ÅÂå∫Âà´Âú®‰∫éÂè™ÂÖ≥Ê≥®Â±ÄÈÉ®ÁöÑÈ°∫Â∫è„ÄÇÁé∞‰ª£ CPU ÂêåÊ†∑‰πü‰∏çËÉΩ‰øùËØÅÈ°∫Â∫è‰∏ÄËá¥ÊÄßÔºåÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÈÉΩ‰ºöËøõË°åÊåá‰ª§ÈáçÊéí‰ª•ËææÂà∞Êõ¥Â•ΩÁöÑÊÄßËÉΩ„ÄÇ</p>
<blockquote>
<p>Âõ†Êûú‰∏ÄËá¥ÊÄßÔºàCausal ConsistencyÔºâ</p>
</blockquote>
<p>Áõ∏ÂêåÁöÑÈ°∫Â∫èÁúãÂà∞Âõ†ÊûúÁõ∏ÂÖ≥ÁöÑÊìç‰ΩúÔºåËÄåÊ≤°ÊúâÂõ†ÊûúÂÖ≥Á≥ªÁöÑÂπ∂ÂèëÊìç‰ΩúÂèØ‰ª•‰π±Â∫èÔºåÂ¶Ç<a class="link" href="https://www.infoq.cn/article/wechat-serial-number-generator-architecture"  target="_blank" rel="noopener"
    >ÂæÆ‰ø°ÁöÑÂèñÂè∑Âô®</a>ËÆæËÆ°Ôºå‰ΩøÁî®ÂÖ®Â±ÄÂîØ‰∏ÄÂçïË∞ÉÈÄíÂ¢ûÁöÑÁî®Êà∑ ID Êù•Á°ÆËÆ§ËØÑËÆ∫ÁöÑÈ°∫Â∫èÔºåÊØèÊù°ËØÑËÆ∫ÁöÑ ID ÈÉΩÊØîÂ∑≤ÁªèËßÅËøáÁöÑÂÖ®Â±Ä ID Ë¶ÅÂ§ßÔºåÁ°Æ‰øùÂõ†ÊûúÂÖ≥Á≥ª„ÄÇ</p>
<h2 id="45-isolation-level">4.5. Isolation Level</h2>
<p>ANSI SQL-92 Ê†áÂáÜÂÆö‰πâ‰∫Ü 4 ÁßçÊï∞ÊçÆÈöîÁ¶ªÁöÑÁ∫ßÂà´Ôºö</p>
<ul>
<li>ËÑèÂÜôÔºàDirty WriteÔºâÔºö‰∏Ä‰∏™‰∫ãÂä°Ë¶ÜÁõñ‰∫ÜÂè¶‰∏Ä‰∏™ËøòÊ≤°Êèê‰∫§‰∫ãÂä°ÁöÑÂÜôÂÖ•ÁöÑÂÄº„ÄÇ‰ºöÁ†¥ÂùèÂÆåÊï¥ÊÄßÁ∫¶ÊùüÔºåÂ§ßÂ§öÊï∞Âú∫ÊôØ‰∏ãÈÉΩÂ∫îËØ•ÈÅøÂÖçËÑèÂÜô„ÄÇ</li>
<li>ËÑèËØªÔºàDirty ReadÔºâÔºö‰∏Ä‰∏™‰∫ãÂä°ËØªÂà∞‰∫ÜÂè¶‰∏Ä‰∏™ËøòÊ≤°Êèê‰∫§ÁöÑ‰∫ãÂä°Â∑≤ÁªèÂÜôÂÖ•ÁöÑÂÄº„ÄÇ</li>
<li>‰∏çÂèØÈáçÂ§çËØªÔºàNon-Repeatable ReadÔºâÔºöÊü•ËØ¢‰∏Ä‰∏™ÂÄº‰∏§Ê¨°Ôºå‰ΩÜÊòØ‰∏§Ê¨°Êü•ËØ¢ÁöÑËøîÂõû‰∏çÂêåÔºå‰πüÁß∞‰∏∫Ê®°Á≥äËØªÔºàRuzzy ReadÔºâ„ÄÇ</li>
<li>ÂπªËØªÔºàPhantom ReadÔºâÔºö‰∏Ä‰∏™‰∫ãÂä°ËøõË°åÊù°‰ª∂Êü•ËØ¢Êó∂ÔºåÂè¶‰∏Ä‰∏™‰∫ãÂä°Âú®‰∏≠Èó¥ÊèíÂÖ•ÊàñËÄÖÂà†Èô§‰∫ÜÊüê‰∫õÊï∞ÊçÆÔºåÂç≥ËØªÂà∞ÁöÑÊï∞ÊçÆÂèòÂ§ö‰∫ÜÊàñËÄÖÂèòÂ∞ë‰∫Ü„ÄÇ</li>
</ul>
<p>Ê≠§Â§ñËøòÊúâ‰∏Ä‰∫õÂºÇÂ∏∏ÊÉÖÂÜµÔºö</p>
<ul>
<li>Êõ¥Êñ∞‰∏¢Â§±ÔºàLost UpdateÔºâÔºöÊåá‰∏§‰∏™‰∫ãÂä°ÂêåÊó∂Êõ¥Êñ∞‰∏Ä‰∏™Êï∞ÂÄºÔºåÊúÄÂêé‰∏§‰∏™Êõ¥Êñ∞Âè™Êúâ‰∏Ä‰∏™ËÉΩÁîüÊïà„ÄÇ</li>
<li>ËØªÂÅèÊñúÔºàRead SkewÔºâÔºöËØªÂà∞‰∫ÜÊï∞ÊçÆ‰∏ÄËá¥ÊÄßÁ∫¶ÊùüË¢´Á†¥ÂùèÁöÑÊï∞ÊçÆÔºå‰∏ÄËà¨ÊåáÁöÑÂ∫îÁî®Â±ÇÈù¢ÔºåÂç≥ ACID ÁöÑ C ‰∏çÊª°Ë∂≥„ÄÇ</li>
<li>ÂÜôÂÅèÊñúÔºàWrite SkewÔºâÔºö‰∏§‰∏™‰∫ãÂä°ËØªÂà∞‰∫ÜÁõ∏ÂêåÁöÑÊï∞ÊçÆÈõÜÔºå‰ΩÜÊòØÂêÑËá™‰øÆÊîπ‰∫Ü‰∏çÁõ∏ÂÖ≥ÁöÑÊï∞ÊçÆÈõÜÔºåÂØºËá¥‰∏ÄËá¥ÊÄßË¢´Á†¥Âùè„ÄÇ</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">ËÑèÂÜô</th>
<th style="text-align:center">ËÑèËØª</th>
<th style="text-align:center">‰∏çÂèØÈáçÂ§çËØª</th>
<th style="text-align:center">ÂπªËØª</th>
<th style="text-align:center">Êõ¥Êñ∞‰∏¢Â§±</th>
<th style="text-align:center">ËØªÂÅèÊñú</th>
<th style="text-align:center">ÂÜôÂÅèÊñú</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ËØªÊú™Êèê‰∫§</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
</tr>
<tr>
<td style="text-align:center">ËØªÂ∑≤Êèê‰∫§</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚úÖ</td>
</tr>
<tr>
<td style="text-align:center">ÂèØÈáçÂ§çËØª</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚úÖ</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
</tr>
<tr>
<td style="text-align:center">‰∏≤Ë°åÂåñ</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
<td style="text-align:center">‚ùå</td>
</tr>
</tbody>
</table></div>
<p><em>ËøôÈáåÁöÑË°®Ê†ºÂº∫‰æùËµñ‰∫éÂÖ∑‰ΩìÂÆûÁé∞ÔºåÂõ†Êï∞ÊçÆÂ∫ìËÄåÂºÇ„ÄÇ</em></p>
<p>ÈúÄË¶ÅËØ¥ÊòéÁöÑÊòØÔºå‰∏ÄËá¥ÊÄßÊ®°ÂûãÂíåÊï∞ÊçÆÂ∫ìÁöÑÈöîÁ¶ªÊ®°Âûã‰∏ªË¶ÅÂå∫Âà´Âú®‰∫éÔºå‰∏ÄËá¥ÊÄßÊ®°Âûã‰∏ÄËà¨Áî®‰∫éÂçï‰∏™ÂØπË±°ÔºåÈöîÁ¶ªÁ∫ßÂà´ÈÄöÂ∏∏ËÆæËÆ°Â§ö‰∏™Êìç‰ΩúÁöÑÂØπË±°ÔºàÂπ∂ÂèëÂú∫ÊôØÔºâ„ÄÇ</p>
<h1 id="5-distributed-consensus">5. Distributed Consensus</h1>
<p>‰∏Ä‰∏™ÂÖ±ËØÜÈóÆÈ¢òÂèØ‰ª•ÊèèËø∞‰∏∫ÔºöÂÅáËÆæÁ≥ªÁªüÊúâ n ‰∏™ËäÇÁÇπÔºåÊØè‰∏™ËäÇÁÇπÁõ∏‰∫íÈÄö‰ø°ÔºåËÆæËÆ°‰∏ÄÁßçÈÄªËæëÔºå‰øùËØÅÂá∫Áé∞ÊïÖÈöúÂêé‰ªçÁÑ∂ËÉΩÂ§üÂçèÂïÜÂá∫Êüê‰∏™‰∏çÂèØ‰ª•Êí§ÈîÄÁöÑÊúÄÁªàÂÜ≥ÂÆöÂÄºÔºå„Ää<a class="link" href="https://jagdishkapadnis.files.wordpress.com/2018/08/santosh-kumar-distributed-systems-algorithmic-approach-information-812.pdf"  target="_blank" rel="noopener"
    >Distributed Systems: An Algorithmic Approach</a>„Äã‰∏Ä‰π¶ÊèêÂá∫ÔºåÂÖ±ËØÜÁÆóÊ≥ïÂ∫îËØ•Êª°Ë∂≥Â¶Ç‰∏ã‰∏â‰∏™ÊÄßË¥®Ôºö</p>
<ol>
<li>ÁªàÊ≠¢ÊÄßÔºàTerminationÔºâÔºöÊâÄÊúâÊ≠£Á°ÆÁöÑËäÇÁÇπÈÉΩ‰ºöËÆ§ÂêåÊüê‰∏Ä‰∏™ÂÄº</li>
<li>ÂçèÂÆöÊÄßÔºàAgreementÔºâÔºöÊâÄÊúâ‰∫âÂèñÁöÑËøõÁ®ãËÆ§ÂêåÁöÑÂÄºÈÉΩÊòØÂêå‰∏Ä‰∏™ÂÄº</li>
<li>ÂÆåÊï¥ÊÄßÔºàIntegrityÔºâÊàñÊúâÊïàÊÄßÔºàValidityÔºâÔºöÊ≠£Á°ÆÁöÑËäÇÁÇπÂÄ°ËÆÆÊüê‰∏™ÂÄº VÔºåÂàôÊâÄÊúâÁöÑÊ≠£Á°ÆÁöÑËäÇÁÇπÈÉΩÂ∫îËØ•Êé•ÂèóËøô‰∏™ V„ÄÇ</li>
</ol>
<p>Âú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÂØπ‰∫é‰∏çÂèØÈù†ÁöÑÁΩëÁªú„ÄÅËøõÁ®ã„ÄÅÊó∂ÈíüÁ≠âÈóÆÈ¢òÔºåÂèØÂΩíÁªì‰∏∫Â¶Ç‰∏ãÊïÖÈöúÊ®°ÂûãÔºàFailure ModelsÔºâË°®Ê†º</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Type</th>
<th>Description of server‚Äôs behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td>Crash failure</td>
<td>Halts, but is working correctly until it halts</td>
</tr>
<tr>
<td>Omission failure(Receive omission Send omission )</td>
<td>1.Fails to respond to incoming requests; 2.Fails to receive incoming messages; 3.Fails to send messages</td>
</tr>
<tr>
<td>Timing failure</td>
<td>Response lies outside a specified time interval</td>
</tr>
<tr>
<td>Response failure (Value failure State-transition failure)</td>
<td>1. Response is incorrect; 2. The value of the response is wrong; 3. Deviates from the correct flow of control</td>
</tr>
<tr>
<td>Arbitrary failure</td>
<td>May produce arbitrary responses at arbitrary times</td>
</tr>
</tbody>
</table></div>
<p>‰∏∫‰∫Ü‰øùËØÅÊïÖÈöúÊÅ¢Â§çÔºåÂ∏∏ÈááÁî®‰∏ÄÁßçÂ§çÂà∂Áä∂ÊÄÅÊú∫Ê®°ÂûãÔºàReplicated State MachinesÔºâ‰πüÁß∞Áä∂ÊÄÅÊú∫Â§çÂà∂ÔºàState Machine Replication, SMRÔºâ„ÄÇ‰∏∫‰∫ÜÂÆûÁé∞Â§çÂà∂Áä∂ÊÄÅÊú∫ÔºåÈÄöÂ∏∏‰ΩøÁî®Â§öÂâØÊú¨ÁöÑÊó•ÂøóÔºàReplicated LogÔºâÁ≥ªÁªüÔºåÂç≥Â§ö‰∏™ËøõÁ®ãÁúãÂà∞ÁöÑÊó•ÂøóÁöÑÈ°∫Â∫èÂíåÂÜÖÂÆπÈÉΩÁõ∏ÂêåÔºåÈÇ£‰πà‰ªñ‰ª¨ÁöÑÁä∂ÊÄÅÂ∫îËØ•‰πüËÉΩÂ§üÁõ∏ÂêåÔºåÂæóÂà∞Áõ∏ÂêåÁöÑËæìÂá∫„ÄÇ</p>
<p>ÂÆûÁé∞Â§çÂà∂Áä∂ÊÄÅÊú∫ÁöÑÂÖ±ËØÜÊ®°ÂûãËÉΩÂ§üËß£ÂÜ≥‰∏ãËø∞ÈóÆÈ¢òÔºö</p>
<ol>
<li>ÁΩëÁªúÔºöÂ∞ΩÁÆ°Âú®‰∏¢ÂåÖ„ÄÅ‰π±Â∫è„ÄÅÈáçÂ§çÂíåÂª∂ËøüÁöÑÂú∫ÊôØ‰∏ãÔºå‰πüËÉΩÁ°Æ‰øùËøîÂõûÊ≠£Á°ÆÁöÑÁªìÊûú</li>
<li>Êó∂ÈíüÔºöÁä∂ÊÄÅÊú∫‰∏çÂÜç‰æùËµñ‰∫éÊó∂Èíü</li>
<li>ÂèØÁî®ÊÄßÔºöÂè™Ë¶ÅËøáÂçäËäÇÁÇπÊ≠£Â∏∏Ôºå‰æøËÉΩ‰øùËØÅÈõÜÁæ§ÂÆåÂÖ®ÂèØÁî®Ôºå‰πüÂèØ‰ª•ÂÆπÂøç‰Ωé‰∫éÂçäÊï∞ËäÇÁÇπÁöÑÊïÖÈöú„ÄÇ</li>
</ol>
<p>Ê≠§Â§ñÔºåËøòËÉΩËß£ÂÜ≥ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑ‰ª•‰∏ãÈóÆÈ¢òÔºö</p>
<ol>
<li>‰∫íÊñ•ÔºàMutual ExclusionÔºâÔºöÂÜ≥ÂÆöÂì™‰∏™ËøõÁ®ã‰ºòÂÖàËÆøÈóÆ‰∏¥ÁïåËµÑÊ∫êÔºåÂÆûÁé∞ÂàÜÂ∏ÉÂºèÈîÅÁ≠â„ÄÇ</li>
<li>ÈÄâ‰∏ªÔºàLeader ElectionÔºâÔºöÂú®ÊïÖÈöúÊó∂ËÉΩÂ§üÊ≠£Â∏∏ÂàáÊç¢ÔºåÂú®ÈÄâÂá∫Êñ∞È¢ÜÂØº‰∏äËææÊàêÂÖ±ËØÜ„ÄÇ</li>
<li>ÂéüÂ≠êÊèê‰∫§ÔºàAtomic CommitÔºâÔºöÂØπ‰∫éË∑®ËäÇÁÇπÊàñË∑®ÂàÜÂå∫ÁöÑÊï∞ÊçÆÂ∫ìÔºåËÉΩÂ§üËÆ©‰∫ãÂä°Âú®Êüê‰∫õÊñπÈù¢Êèê‰∫§ÊàêÂäüÔºåÊüê‰∫õÊñπÈù¢Â§±Ë¥•„ÄÇ</li>
</ol>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fault prevention</td>
<td>Prevent the occurrence of a fault</td>
<td>Don‚Äôt hire sloppy programmers</td>
</tr>
<tr>
<td>Fault tolerance</td>
<td>Build a component such that it can mask the occurrence of a fault</td>
<td>Build each component by two independent programmers</td>
</tr>
<tr>
<td>Fault removal</td>
<td>Reduce the presence, number, or seriousness of a fault</td>
<td>Get rid of sloppy programmers</td>
</tr>
<tr>
<td>Fault forecasting</td>
<td>Estimate current presence, future incidence, and consequences of faults</td>
<td>Estimate how a recruiter is doing when it comes to hiring sloppy programmers</td>
</tr>
</tbody>
</table></div>
<h2 id="51-flp-impossibility">5.1. FLP Impossibility</h2>
<p>MICHAEL J. FISCHER, NANCY A. LYNCH Âíå MICHAEL S. PATERSON ‰∏â‰∏™‰∫∫ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://groups.csail.mit.edu/tds/papers/Lynch/jacm85.pdf"  target="_blank" rel="noopener"
    >Impossibility of Distributed Consensus with One Faulty Process</a>ÔºåËØÅÊòé‰∫ÜÂú®‰∏Ä‰∏™ÂÆåÂÖ®ÂºÇÊ≠•ÁöÑÁ≥ªÁªü‰∏≠ÔºàËøõÁ®ãÂèØËÉΩÂæàÊÖ¢ÂìçÂ∫îÔºåÊó†Ê≥ïÂàÜËæ®ÊòØÈÄüÂ∫¶ÂæàÊÖ¢ËøòÊòØÂ∑≤ÁªèÂ¥©Ê∫ÉÔºâÔºåÂç≥‰æøÂè™Êúâ‰∏Ä‰∏™ËäÇÁÇπÂèëÁîü‰∫ÜÊïÖÈöúÔºå‰πü‰∏çÂ≠òÂú®‰∏Ä‰∏™ÁÆóÊ≥ï‰ΩøÂæóÁ≥ªÁªüËææÊàêÂÖ±ËØÜ„ÄÇÊç¢Âè•ËØùËØ¥ÔºåÂ¶ÇÊûúÁ≥ªÁªüÁöÑËäÇÁÇπÂú®ÂÆïÊú∫ÂêéÊó†Ê≥ïÊÅ¢Â§çÔºåÈÇ£‰πà‰∏çÂ≠òÂú®‰ªª‰Ωï‰∏ÄÁßçÂàÜÂ∏ÉÂºèÂçèËÆÆÂèØ‰ª•ËææÊàêÂÖ±ËØÜ„ÄÇ</p>
<p>Êç¢‰∏ÄÁßçÁ±ª‰ºº‰∫é CAP ÂÆöÁêÜÁöÑËØ¥Ê≥ïÔºåÂç≥Êàë‰ª¨‰∏çÂèØËÉΩÂú®ÂÆåÂÖ®ÂºÇÊ≠•Á≥ªÁªü‰∏≠ÂêåÊó∂Êª°Ë∂≥ÂÆâÂÖ®ÊÄßÔºàSafetyÔºåÊâÄÊúâÊ≠£Á°ÆÁöÑËäÇÁÇπÈÉΩËÆ§ÂèØÂêå‰∏Ä‰∏™ÂÄºÔºâ„ÄÅÊ¥ªÊÄßÔºàLivenessÔºåÊúÄÁªàËÆ§ÂèØ‰∏Ä‰∏™Á°ÆÂÆöÂÄºÔºâÂíåÂÆπÈîôÊÄßÔºàFault ToleranceÔºâ„ÄÇÂÆûÈôÖ‰∏äÔºåÊàë‰ª¨ÂøÖÈ°ªÊîæÂÆΩÂØπÂºÇÊ≠•ÁΩëÁªúÁöÑÂÅáËÆæÁªïËøá FLP ‰∏çÂèØËÉΩÂÆöÁêÜÔºåÊâæÂà∞Â∑•Á®ãÊúÄ‰ºòËß£„ÄÇÂ∏∏ËßÅÁöÑÊñπÊ°àÊúâ‰∏âÁßçÔºöÊïÖÈöúÂ±èËîΩÔºàFault MaskingÔºâ„ÄÅÊïÖÈöúÊ£ÄÊµãÔºàFailure DetectorsÔºâ„ÄÅÈöèÊú∫ÁÆóÊ≥ïÔºàNon-DeterminismÔºâ„ÄÇ</p>
<blockquote>
<p>ÊïÖÈöúÂ±èËîΩÔºàFault MaskingÔºâ</p>
</blockquote>
<p>Â∞Ü FLP ‰∏çÂèØËÉΩÊèèËø∞‰∏≠ÁöÑÂºÇÊ≠•Á≥ªÁªüÔºåËΩ¨Âèò‰∏∫ÂêåÊ≠•Á≥ªÁªüÔºåÂç≥ÂÅáËÆæÊïÖÈöúÁöÑËøõÁ®ãÊúÄÁªà‰∏ÄÂÆöËÉΩÂ§üÊÅ¢Â§çÔºåÂπ∂‰∏îÊâæÂà∞‰∏ÄÁßçÈáçÊñ∞Âä†ÂÖ•Âà∞Á≥ªÁªüÁöÑÊñπÂºè„ÄÇËøôÊ†∑Â¶ÇÊûúÊüê‰∏™ËäÇÁÇπÊ≤°ÊúâÂèóÂà∞Ê∂àÊÅØÔºå‰æøÂÖÅËÆ∏ÈïøÊó∂Èó¥ÁöÑÁ≠âÂæÖÔºåÁõ¥Âà∞Êî∂Âà∞ÊúüÊúõÁöÑÊ∂àÊÅØ„ÄÇ</p>
<p>Ëá™Âä®ÈáçÂêØÁöÑËøõÁ®ãÂèØ‰ª•ÈááÁî®ÊåÅ‰πÖÂåñÁöÑÊñπÊ°àÔºåÂ¶ÇÂú® 2PC ÂçèËÆÆ‰∏≠ÔºåÊ∑ªÂä†ÊåÅ‰πÖÂåñÁöÑÂ≠òÂÇ®ÔºåËÆ©ËøõÁ®ãËÉΩÂ§üÊÅ¢Â§çÂà∞ÂéüÊù•ÁöÑÁä∂ÊÄÅ„ÄÇ</p>
<blockquote>
<p>‰ΩøÁî®ÊïÖÈöúÊ£ÄÊµãÂô®ÔºàFailure DetectorsÔºâ</p>
</blockquote>
<p>ÈÄöËøáÊüêÁßçÊïÖÈöúÊ£ÄÊµãÂô®Êù•Âà§Êñ≠ËøõÁ®ãÊòØÂê¶ÂèëÁîü‰∫ÜÂºÇÂ∏∏ÔºåÂÖ∂‰∏≠ Tushar Deepak Chandra„ÄÅVassos Hadzilacos Âíå Sam Toueg ÁöÑËÆ∫Êñá <a class="link" href="https://dl.acm.org/doi/pdf/10.1145/135419.135451#:~:text=Thus%2C%20OVV%20is%20indeed%20the,a%20majority%20of%20correct%20processes."  target="_blank" rel="noopener"
    >The Weakest Failure Detector for Solving Consensus*</a> ÊèêÂá∫‰∫ÜÊïÖÈöúÊ£ÄÊµãÂô®Â∫îËØ•Êª°Ë∂≥ÁöÑ‰∏§‰∏™Â±ûÊÄß</p>
<ul>
<li>ÂÆåÂÖ®ÊÄßÔºàCompletenessÔºâÔºöÊØè‰∏™ÊïÖÈöúÁöÑËøõÁ®ãÈÉΩÂ∫îËØ•Ë¢´‰∏Ä‰∏™Ê≠£Á°ÆÁöÑËøõÁ®ãÊÄÄÁñë„ÄÇ</li>
<li>Á≤æÁ°ÆÊÄßÔºàAccuracyÔºâÔºöÊ≠£Á°ÆÁöÑËøõÁ®ã‰∏çÂ∫îËØ•Ë¢´ÂÖ∂‰ªñËøõÁ®ãÊÄÄÁñë„ÄÇ</li>
</ul>
<p>‰∏äËø∞Êù°‰ª∂‰∏ç‰∏ÄÂÆöË¶ÅÂΩªÂ∫ïÂÆûÁé∞ÔºåÂç≥‰æø‰ΩøÁî®‰∏çÂÆåÁæéÁöÑÊïÖÈöúÊ£ÄÊµãÂô®ÔºåÂú®ÈÄö‰ø°ÂèØÈù†ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ§±ÊïàÁöÑËäÇÁÇπ‰∏çË∂ÖËøá N/2 Ôºå‰æùÁÑ∂ËÉΩ‰ΩøÁî®Êù•Ëß£ÂÜ≥ÂÖ±ËØÜÈóÆÈ¢òÔºåÂç≥ÊúÄÁªàÂº±ÊïÖÈöúÊ£ÄÊµãÂô®ÔºàEventually Weakly Failure DetectorÔºâÔºåÂ∫îËØ•Êª°Ë∂≥Â¶Ç‰∏ã‰∏§‰∏™ÊÄßË¥®„ÄÇ</p>
<ul>
<li>ÊúÄÁªàÂº±ÂÆåÂÖ®ÊÄßÔºàEventually Weakly CompleteÔºâÔºöÊØè‰∏™ÊïÖÈöúÁöÑËøõÁ®ãÈÉΩ‰ºöË¢´‰∏Ä‰∫õÊ≠£Á°ÆÁöÑËøõÁ®ãÊ£ÄÊµãÂà∞</li>
<li>ÊúÄÁªàÂº±Á≤æÁ°ÆÊÄßÔºàEventually Weakly AccurateÔºâÔºö‰∏ÄÊÆµÊó∂Èó¥ÂêéÔºåÊ≠£Á°ÆÁöÑËøõÁ®ã‰∏ç‰ºöË¢´ÂÖ∂‰ªñËøõÁ®ãÊÄÄÁñë</li>
</ul>
<blockquote>
<p>ÈöèÊú∫ÁÆóÊ≥ïÔºàNon-DeterminismÔºâ</p>
</blockquote>
<p>ÈÄöËøá‰ΩøÁî®ÈöèÊú∫ÁÆóÊ≥ïÔºå‰ΩøÂæóÊãúÂç†Â∫≠ÈóÆÈ¢ò‰∏≠ÁöÑ‚ÄúÂèõÂæí‚Äù‰∏çËÉΩÊúâÊïàÈòªÁ¢çÁ≥ªÁªüËææÊàêÂÖ±ËØÜ„ÄÇÂ¶ÇÂå∫ÂùóÈìæÂ∫îÁî®‰∏≠ÔºåÂü∫‰∫éÊúÄÂø´ËøêÁÆóÁªìÊûúËäÇÁÇπËÄåËææÊàêÁöÑÂÖ±ËØÜÔºåÂ¶Ç BitCoin ÈááÁî®ÁöÑ <a class="link" href="https://github.com/bitcoin/bitcoin/blob/e9262ea32a6e1d364fb7974844fadc36f931f8c6/src/pow.cpp"  target="_blank" rel="noopener"
    >PoW</a>ÔºàProof of WorkÔºâËææÊàêÁöÑÂÖ±ËØÜÔºõ‰ª•Âèä Ethereum„ÄÅDASH„ÄÅNEO ‰ΩøÁî®ÁöÑ <a class="link" href="https://www.mckinsey.com/featured-insights/mckinsey-explainers/what-is-proof-of-stake"  target="_blank" rel="noopener"
    >PoS</a>ÔºàProof of StakeÔºâËææÊàêÁöÑÂÖ±ËØÜÁ≠â„ÄÇÂΩìÁÑ∂ÔºåÂØπ‰∫éÊîªÂáªËÄÖÔºåÂõ§ÁßØ 50% ‰ª•‰∏äÁÆóÂäõ‰πüÂèØ‰ª•ÂèëÂä® PoW ÁöÑÂ•≥Â∑´ÊîªÂáªÔºàSybil AttackÔºâÔºåÊù•ÂáªÈÄÄÁΩëÁªú‰∏äÁöÑÂ§ßÈÉ®ÂàÜËäÇÁÇπ„ÄÇ</p>
<h2 id="52-paxos">5.2. Paxos</h2>
<p>Danny Dolev Âíå H. Raymond Strong ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://www.csa.iisc.ac.in/~arpita/BroadcastBAReadingGroup/DS83.pdf"  target="_blank" rel="noopener"
    >Authenticated algorithms for byzantine agreement</a> ÊèêÂá∫‰∫Ü Dolev-Strong ÁÆóÊ≥ïÔºöÂú®ÂêåÊ≠•Á≥ªÁªü‰∏≠Ôºå‰∏çË∂ÖËøá F ‰∏™ËøõÁ®ãÂèëÁîüÊïÖÈöúÔºå‰∏îÈîôËØØÁöÑËøõÁ®ãÊï∞Èáè F Â∞è‰∫éÊÄªËøõÁ®ãÊï∞ NÔºåÂàôÁªèËøá F+1 ËÆ∫Ê∂àÊÅØ‰º†ÈÄíÂêéÔºå‰∏ÄÂÆöËÉΩËææÊàêÂÖ±ËØÜ„ÄÇÁîü‰∫ßÁéØÂ¢É‰∏≠Â§ßÂ§öÊï∞ÂÖ±ËØÜÁÆóÊ≥ïÈÉΩÊòØÂü∫‰∫éÂêåÊ≠•ÂÆûÁé∞Ôºå‰∫ëÊúçÂä°ÁéØÂ¢ÉÂú®‰ºÅ‰∏öÁöÑÊï∞ÊçÆ‰∏≠ÂøÉ‰πüÂü∫Êú¨Êó†ÈúÄËÄÉËôëÊãúÂç†Â∫≠ÂÆπÈîô„ÄÇ</p>
<p>Paxos ÁÆóÊ≥ïÊòØ Lamport Âú®ËÆ∫Êñá <a class="link" href="https://lamport.azurewebsites.net/pubs/lamport-paxos.pdf"  target="_blank" rel="noopener"
    >The Part-Time Parliament</a> ÊèêÂá∫ÁöÑÂÖ±ËØÜÁÆóÊ≥ï„ÄÇÂπ∂ÊúÄÂêéÈáçÂÜô‰∫Ü‰∏Ä‰∏™Êõ¥Âä†ÁÆÄÁü≠ÁöÑËÆ∫Êñá <a class="link" href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf"  target="_blank" rel="noopener"
    >Paxos Made Simple</a>„ÄÇ</p>
<p>Âú® Paxos Â≤õ‰∏äÔºåÊØè‰∏™ËÆÆÂëòÈÉΩÊòØÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑËäÇÁÇπÔºåÊØè‰∏™ËÆÆÂëòÈÉΩ‰ºöËøõË°åÊèêÊ°àÔºàProposalÔºâÂØπÂ∫îÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑÁä∂ÊÄÅÔºåÂåÖÊã¨ÊèêÊ°àÁºñÂè∑ÔºàProposal Number or BallotÔºâÂíåÊèêÊ°àÂÄºÔºàProposal ValueÔºâ„ÄÇ</p>
<p>ÊØè‰∏™ËÆÆÂëòÈÉΩ‰ºöÈÄöËøáÊ∂àÊÅØ‰º†ÈÄí‰∏çÊñ≠ÊèêÂá∫ÊèêÊ°àÔºåË∂ÖËøáÂçäÊï∞ÁöÑËäÇÁÇπÂêåÊÑèÔºåÂàôÊúÄÁªà‰ΩøÊï¥‰∏™Á≥ªÁªüÊé•ÂèóÂêå‰∏Ä‰∏™ÊèêÊ°àÔºå‰πüÁß∞ÊèêÊ°àÊâπÂáÜÔºàChosenÔºâ„ÄÇ‰∏ÄËà¨Êù•ËØ¥ Paxos ÁÆóÊ≥ïÊúâ‰∏â‰∏™Áä∂ÊÄÅÔºö</p>
<ul>
<li>ÊèêËÆÆËÄÖÔºàProposerÔºâÔºöÊèêËÆÆËÄÖÂèóÂà∞ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÔºåÂàôÊèêÂá∫ÊèêÊ°àÔºåËØïÂõæËÆ©Êé•ÂèóËÄÖÊé•ÂèóÂπ∂‰∏îÂú®ÂÜ≤Á™ÅÊó∂ÂàªËøõË°åÂçèË∞É</li>
<li>Êé•ÂèóËÄÖÔºàAcceptorÔºâÔºö‰πüÁß∞‰∏∫ÊäïÁ•®ËÄÖÔºàVoterÔºâÔºåÂç≥Êé•ÂèóÊàñÊãíÁªùÊèêÊ°àÔºåË∂ÖËøáÂçäÊï∞Êé•ÂèóÂàô‰∏∫ÊâπÂáÜ„ÄÇ</li>
<li>Â≠¶‰π†ËÄÖÔºàLearnerÔºâÔºöÂ≠¶‰π†ËÄÖÂè™ËÉΩÂ≠¶‰π†Ë¢´ÊâπÂáÜÁöÑÊèêÊ°àÔºå‰∏çËÉΩÂèÇ‰∏éÊèêÊ°àÁöÑÂÜ≥ËÆÆÔºåÂÆ¢Êà∑Á´ØÂ¶ÇÊûúÊî∂Âà∞‰∫ÜÊé•ÂèóËÄÖÁöÑÂêåÊÑèÔºåÂàôÂ≠¶‰π†ËÄÖÂèØ‰ª•Â≠¶‰π†Âà∞ÊèêÊ°àÂÄº„ÄÇ</li>
</ul>
<blockquote>
<p>Basic Paxos</p>
</blockquote>
<p>Basic Paxos Âè™ÂÜ≥ËÆÆÂá∫‰∏Ä‰∏™ÂÖ±ËØÜÁöÑÂÄºÔºå‰∏ªË¶ÅÂàÜ‰∏∫‰∏§‰∏™Èò∂ÊÆµÔºåÊØè‰∏™Èò∂ÊÆµÂàÜ ab ‰∏§‰∏™ÈÉ®ÂàÜÔºåËÆ∞‰Ωú 1a, 1b, 2a, 2bÔºàÂÖ∂‰∏≠ a, b ÂàÜÂà´‰ª£Ë°®ËØ∑Ê±ÇÂíåÁõ∏Â∫î‰∏§‰∏™Èò∂ÊÆµÔºâÔºå‰∏ãÁî® <a class="link" href="https://github.com/tlaplus/tlaplus"  target="_blank" rel="noopener"
    >TLA+</a> ÂØπ Paxos ÁÆóÊ≥ïËøõË°åÁÆÄÂçïÊèèËø∞„ÄÇ</p>
<p>Phase1aÔºå‰πüÁß∞‰∏∫ Prepare Èò∂ÊÆµÔºåÂèëÈÄÅ‰∏Ä‰∏™Á±ªÂûã‰∏∫ 1a ÁöÑÊ∂àÊÅØÔºåÂÖ∂‰∏≠ ballot Ê†áËÆ∞‰∏∫ b„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Phase1a(b) == /\ Send([type |-&gt; &#34;1a&#34;, bal |-&gt; b])
</span></span><span class="line"><span class="cl">              /\ UNCHANGED &lt;&lt;maxBal, maxVBal, maxVal&gt;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Phase1bÔºå‰πüÁß∞‰∏∫ Promise Èò∂ÊÆµÔºåÊé•ÂèóËÄÖÂØπÂèóÂà∞ÁöÑ Prepare Ê∂àÊÅØËøõË°åÂà§Êñ≠</p>
<ul>
<li>Â¶ÇÊûú 1a Ê∂àÊÅØÁöÑÊèêÊ°àÁºñÂè∑Â§ß‰∫éËá™Â∑±ÁöÑÔºåÂàôËøîÂõû 1b Ê∂àÊÅØÔºå‰øùËØÅ‰∏ç‰ºöÂÜçÊé•Êî∂ÁºñÂè∑Â∞è‰∫éÂΩìÂâç ballot ÁöÑÊèêÊ°àÔºõÂ¶ÇÊûúÊé•ÂèóËÄÖÂ∑≤ÁªèÊé•Êî∂‰∫ÜÊõ¥Êó©ÁöÑÊèêÊ°àÂè∑ÔºåÂàô‰ºöÂìçÂ∫îÂâç‰∏ÄÊ¨°ÁöÑ ballot ÁªôÊèêËÆÆËÄÖ„ÄÇ</li>
<li>Âê¶ÂàôÔºåÂøΩÁï•Ëøô‰∏™ËØ∑Ê±ÇÔºà‰πüÂèØ‰ª•ÂèëÈÄÅ‰∏Ä‰∏™ÊãíÁªùÁöÑÂìçÂ∫îÔºâ„ÄÇ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Phase1b(a) == /\ \E m \in msgs :
</span></span><span class="line"><span class="cl">                  /\ m.type = &#34;1a&#34;
</span></span><span class="line"><span class="cl">                  /\ m.bal &gt; maxBal[a]
</span></span><span class="line"><span class="cl">                  /\ maxBal&#39; = [maxBal EXCEPT ![a] = m.bal]
</span></span><span class="line"><span class="cl">                  /\ Send([type |-&gt; &#34;1b&#34;, acc |-&gt; a, bal |-&gt; m.bal,
</span></span><span class="line"><span class="cl">                            mbal |-&gt; maxVBal[a], mval |-&gt; maxVal[a]])
</span></span><span class="line"><span class="cl">              /\ UNCHANGED &lt;&lt;maxVBal, maxVal&gt;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Phase2aÔºå‰πüÁß∞‰∏∫ Accept ÊàñËÄÖ Propose Èò∂ÊÆµÔºåÊèêËÆÆËÄÖÊî∂Âà∞ËøáÂçäÊï∞ÁöÑÂìçÂ∫îÂêéÔºåÊèêËÆÆËÄÖÂêëÂ§öÊï∞Ê¥æÊé•ÂèóËÄÖÂèëÈÄÅ 2a ËØ∑Ê±ÇÔºåÂπ∂‰∏îÂëäËØâ‰ªñ‰ª¨ ballot Âíå value„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Phase2a(b, v) == /\ ~ \E m \in msgs : m.type = &#34;2a&#34; /\ m.bal = b
</span></span><span class="line"><span class="cl">                 /\ \E Q \in Quorum :
</span></span><span class="line"><span class="cl">                        LET Q1b == {m \in msgs : /\ m.type = &#34;1b&#34;
</span></span><span class="line"><span class="cl">                                                 /\ m.acc \in Q
</span></span><span class="line"><span class="cl">                                                 /\ m.bal = b}
</span></span><span class="line"><span class="cl">                            Q1bv == {m \in Q1b : m.mbal \geq 0}
</span></span><span class="line"><span class="cl">                        IN  /\ \A a \in Q : \E m \in Q1b : m.acc = a
</span></span><span class="line"><span class="cl">                            /\ \/ Q1bv = {}
</span></span><span class="line"><span class="cl">                            \/ \E m \in Q1bv :
</span></span><span class="line"><span class="cl">                                    /\ m.mval = v
</span></span><span class="line"><span class="cl">                                    /\ \A mm \in Q1bv : m.mbal \geq mm.mbal
</span></span><span class="line"><span class="cl">                 /\ Send([type |-&gt; &#34;2a&#34;, bal |-&gt; b, val |-&gt; v])
</span></span><span class="line"><span class="cl">                 /\ UNCHANGED &lt;&lt;maxBal, maxVBal, maxVal&gt;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Phase2bÔºå‰πüÁß∞‰∏∫ Accepted Èò∂ÊÆµÔºåÊé•ÂèóËÄÖÊî∂Âà∞ 2a ËØ∑Ê±ÇÂêéÔºåÂ¶ÇÊûúÊ≤°ÊúâÂè¶Â§ñÊâøËØ∫ÊØîÂΩìÂâç ballot Êõ¥Â§ßÁöÑÊèêÊ°àÔºåÂàôÊé•ÂèóËØ•ÊèêÊ°àÔºåÊõ¥Êñ∞ÊâøËØ∫ÁöÑÊèêÊ°àÁºñÂè∑„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Phase2b(a) == \E m \in msgs : /\ m.type = &#34;2a&#34;
</span></span><span class="line"><span class="cl">                              /\ m.bal \geq maxBal[a]
</span></span><span class="line"><span class="cl">                              /\ maxBal&#39; = [maxBal EXCEPT ![a] = m.bal]
</span></span><span class="line"><span class="cl">                              /\ maxVBal&#39; = [maxVBal EXCEPT ![a] = m.bal]
</span></span><span class="line"><span class="cl">                              /\ maxVal&#39; = [maxVal EXCEPT ![a] = m.val]
</span></span><span class="line"><span class="cl">                              /\ Send([type |-&gt; &#34;2b&#34;, acc |-&gt; a,
</span></span><span class="line"><span class="cl">                                       bal |-&gt; m.bal, val |-&gt; m.val])
</span></span></code></pre></td></tr></table>
</div>
</div><p>FLP ‰∏çÂèØËÉΩÂÆöÁêÜÂØπ‰∫é Paxos ‰πüÁîüÊïàÔºåÂæàÂèØËÉΩÂ§ö‰∏™ËäÇÁÇπÁöÑ Prepare Ê∂àÊÅØÊ∫êÊ∫ê‰∏çÊñ≠Ôºå‰ª•Ëá≥‰∫éË∞ÅÈÉΩ‰∏çËÉΩÊé•ÂèóÊñ∞ÁöÑÊèêÊ°àÔºàÊ¥ªÈîÅÈóÆÈ¢òÔºâ„ÄÇÂèØ‰ª•ÈÄöËøáÂºïÂÖ•ÈöèÊú∫Êó∂Èó¥Ëß£ÂÜ≥„ÄÇ</p>
<h2 id="53-raft">5.3. Raft</h2>
<p>ÊñØÂù¶Á¶èÂ§ßÂ≠¶ÁöÑ Diego Ongaro Âíå John Ousterhout ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://raft.github.io/raft.pdf"  target="_blank" rel="noopener"
    >In Search of an Understandable Consensus Algorithm
(Extended Version)</a>ÔºåÊèêÂá∫ÁöÑ Raft ÁÆóÊ≥ïÔºå‰πüÂèØ‰ª•ÁêÜËß£‰∏∫ÔºàR{eliable|eplicated|edundant} And Fault-TolerantÔºâ„ÄÇ</p>
<p>Raft ÁÆóÊ≥ïÊâÄËøêË°åÁöÑÁ≥ªÁªüÊ®°ÂûãÂü∫‰∫é‰ª•‰∏ãÂÅáËÆæÔºö</p>
<ul>
<li>ÊúçÂä°Âô®ÂèØËÉΩÂÆïÊú∫„ÄÅÂÅúÊ≠¢ËøêË°åÔºåËøáÊÆµÊó∂Èó¥ÊÅ¢Â§çÔºå‰ΩÜ‰∏çÂ≠òÂú®ÊãúÂç†Â∫≠ÊïÖÈöúÔºåËäÇÁÇπË°å‰∏∫ÈùûÊÅ∂ÊÑè„ÄÇ</li>
<li>Ê∂àÊÅØÂèØËÉΩ‰∏¢Â§±Ôºå‰π±Â∫èÔºåÈáçÂ§çÔºõÂèØËÉΩÊúâÁΩëÁªúÂàÜÂå∫ÔºåÂπ∂Âú®‰∏ÄÊÆµÊó∂Èó¥ÂêéÊÅ¢Â§ç„ÄÇ</li>
</ul>
<p>Raft ÁÆóÊ≥ïÁöÑÊúçÂä°Âô®‰∏≠‰ªªÊÑèÊúçÂä°Âô®Âè™ËÉΩÂ≠òÂú®‰ª•‰∏ã‰∏â‰∏™Áä∂ÊÄÅ‰πã‰∏Ä„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Follower</span> <span class="p">=</span> <span class="kc">iota</span> <span class="c1">// Ë∑üÈöèËÄÖÔºåÂÆåÂÖ®Ë¢´Âä®Â§ÑÁêÜËØ∑Ê±ÇÔºå‰∏ç‰∏ªÂä®ÂèëÈÄÅ RPC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Candidate</span>       <span class="c1">// ÂÄôÈÄâËÄÖÔºåÊòØÂ§Ñ‰∫éÈ¢ÜÂØºËÄÖÂíåË∑üÈöèËÄÖÁöÑ‰∏≠Èó¥Áä∂ÊÄÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Leader</span>          <span class="c1">// È¢ÜÂØºËÄÖÔºåË¥üË¥£Â§ÑÁêÜÊâÄÊúâÂÆ¢Êà∑ËØ∑Ê±ÇÂíåÊó•ÂøóÂ§çÂà∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ª•‰∏ãÊòØ‰ΩøÁî® TLA+ ÂØπÁÆóÊ≥ïÁöÑÊèèËø∞ÔºåÂØπÂ∫îÁöÑ‰ª£Á†ÅÁâáÊÆµÊù•Ê∫ê‰∫é <a class="link" href="https://github.com/ongardie/raft.tla"  target="_blank" rel="noopener"
    >https://github.com/ongardie/raft.tla</a>ÔºåÈÅµÂæ™ <a class="link" href="https://creativecommons.org/licenses/by/4.0/"  target="_blank" rel="noopener"
    >CC BY-NC-SA 4.0</a> ÂçèËÆÆ„ÄÇ</p>
<p>ÂΩìËäÇÁÇπÂú®Ë∂ÖÊó∂Êó∂Èó¥Ê≤°ÊúâÊî∂Âà∞‰ªªÊúüÊõ¥Â§ßÁöÑ RPC ËØ∑Ê±ÇÔºåÂàôËÆ§‰∏∫ÂΩìÂâç Leader ÂÆïÊú∫ÔºåËØ•ËäÇÁÇπ‰ºöÊõ¥ÊîπËá™Â∑±ÁöÑ‰ªªÊúüÔºåÂºÄÂßãÁ´ûÈÄâÊó∂ÔºåËÆæÁΩÆÂΩìÂâçÁä∂ÊÄÅ‰∏∫ CandiateÔºåÂèëËµ∑Á¥¢Ë¶ÅÊäïÁ•®ÁöÑËØ∑Ê±Ç„ÄÇ
ÂΩìËäÇÁÇπÊî∂Âà∞‰∫ÜÂçäÊï∞‰ª•‰∏äÈÄâÁ•®Êó∂ÔºåÂàôÂèØ‰ª•ÂΩìÈÄâ‰∏∫ Leader„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">\* Server i times out and starts a new election.
</span></span><span class="line"><span class="cl">Timeout(i) == /\ state[i] \in {Follower, Candidate}
</span></span><span class="line"><span class="cl">              /\ state&#39; = [state EXCEPT ![i] = Candidate]
</span></span><span class="line"><span class="cl">              /\ currentTerm&#39; = [currentTerm EXCEPT ![i] = currentTerm[i] + 1]
</span></span><span class="line"><span class="cl">              \* Most implementations would probably just set the local vote
</span></span><span class="line"><span class="cl">              \* atomically, but messaging localhost for it is weaker.
</span></span><span class="line"><span class="cl">              /\ votedFor&#39; = [votedFor EXCEPT ![i] = Nil]
</span></span><span class="line"><span class="cl">              /\ votesResponded&#39; = [votesResponded EXCEPT ![i] = {}]
</span></span><span class="line"><span class="cl">              /\ votesGranted&#39;   = [votesGranted EXCEPT ![i] = {}]
</span></span><span class="line"><span class="cl">              /\ voterLog&#39;       = [voterLog EXCEPT ![i] = [j \in {} |-&gt; &lt;&lt;&gt;&gt;]]
</span></span><span class="line"><span class="cl">              /\ UNCHANGED &lt;&lt;messages, leaderVars, logVars&gt;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">\* Candidate i sends j a RequestVote request.
</span></span><span class="line"><span class="cl">RequestVote(i, j) == /\ state[i] = Candidate
</span></span><span class="line"><span class="cl">                     /\ j \notin votesResponded[i]
</span></span><span class="line"><span class="cl">                     /\ Send([mtype         |-&gt; RequestVoteRequest,
</span></span><span class="line"><span class="cl">                             mterm         |-&gt; currentTerm[i],
</span></span><span class="line"><span class="cl">                             mlastLogTerm  |-&gt; LastTerm(log[i]),
</span></span><span class="line"><span class="cl">                             mlastLogIndex |-&gt; Len(log[i]),
</span></span><span class="line"><span class="cl">                             msource       |-&gt; i,
</span></span><span class="line"><span class="cl">                             mdest         |-&gt; j])
</span></span><span class="line"><span class="cl">                     /\ UNCHANGED &lt;&lt;serverVars, candidateVars, leaderVars, logVars&gt;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">\* Candidate i transitions to leader.
</span></span><span class="line"><span class="cl">BecomeLeader(i) ==
</span></span><span class="line"><span class="cl">    /\ state[i] = Candidate
</span></span><span class="line"><span class="cl">    /\ votesGranted[i] \in Quorum
</span></span><span class="line"><span class="cl">    /\ state&#39;      = [state EXCEPT ![i] = Leader]
</span></span><span class="line"><span class="cl">    /\ nextIndex&#39;  = [nextIndex EXCEPT ![i] =
</span></span><span class="line"><span class="cl">                         [j \in Server |-&gt; Len(log[i]) + 1]]
</span></span><span class="line"><span class="cl">    /\ matchIndex&#39; = [matchIndex EXCEPT ![i] =
</span></span><span class="line"><span class="cl">                         [j \in Server |-&gt; 0]]
</span></span><span class="line"><span class="cl">    /\ elections&#39;  = elections \cup
</span></span><span class="line"><span class="cl">                         {[eterm     |-&gt; currentTerm[i],
</span></span><span class="line"><span class="cl">                           eleader   |-&gt; i,
</span></span><span class="line"><span class="cl">                           elog      |-&gt; log[i],
</span></span><span class="line"><span class="cl">                           evotes    |-&gt; votesGranted[i],
</span></span><span class="line"><span class="cl">                           evoterLog |-&gt; voterLog[i]]}
</span></span><span class="line"><span class="cl">    /\ UNCHANGED &lt;&lt;messages, currentTerm, votedFor, candidateVars, logVars&gt;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Raft ÁÆóÊ≥ïÈÄöËøáÁ¥¢ÂºïÂíå‰ªªÊúüÂè∑ÂîØ‰∏ÄÊ†áËØÜ‰∏ÄÊù°Êó•ÂøóËÆ∞ÂΩïÔºåÈÄöËøá AppendEntries Êù•Â§çÂà∂Êó•Âøó„ÄÇ</p>
<p>Â¶ÇÊûú‰∏§‰∏™ËäÇÁÇπÁöÑÊó•ÂøóÂú®Áõ∏ÂêåÁöÑÁ¥¢Âºï‰ΩçÁΩÆ‰∏äÁöÑ‰ªªÊúüÂè∑Áõ∏ÂêåÔºåÂàôËÆ§‰∏∫ÊòØ‰∏ÄÊ†∑ÁöÑÂëΩ‰ª§ÔºõÂ¶ÇÊûúÂΩìÂâçÁöÑÊó•ÂøóË¢´Êèê‰∫§ÔºåÂàô‰πãÂâçÁöÑÊó•ÂøóÈÉΩÂà§ÂÆö‰∏∫Â∑≤Êèê‰∫§„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">\* Leader i sends j an AppendEntries request containing up to 1 entry.
</span></span><span class="line"><span class="cl">\* While implementations may want to send more than 1 at a time, this spec uses
</span></span><span class="line"><span class="cl">\* just 1 because it minimizes atomic regions without loss of generality.
</span></span><span class="line"><span class="cl">AppendEntries(i, j) ==
</span></span><span class="line"><span class="cl">    /\ i /= j
</span></span><span class="line"><span class="cl">    /\ state[i] = Leader
</span></span><span class="line"><span class="cl">    /\ LET prevLogIndex == nextIndex[i][j] - 1
</span></span><span class="line"><span class="cl">           prevLogTerm == IF prevLogIndex &gt; 0 THEN
</span></span><span class="line"><span class="cl">                              log[i][prevLogIndex].term
</span></span><span class="line"><span class="cl">                          ELSE
</span></span><span class="line"><span class="cl">                              0
</span></span><span class="line"><span class="cl">           \* Send up to 1 entry, constrained by the end of the log.
</span></span><span class="line"><span class="cl">           lastEntry == Min({Len(log[i]), nextIndex[i][j]})
</span></span><span class="line"><span class="cl">           entries == SubSeq(log[i], nextIndex[i][j], lastEntry)
</span></span><span class="line"><span class="cl">       IN Send([mtype          |-&gt; AppendEntriesRequest,
</span></span><span class="line"><span class="cl">                mterm          |-&gt; currentTerm[i],
</span></span><span class="line"><span class="cl">                mprevLogIndex  |-&gt; prevLogIndex,
</span></span><span class="line"><span class="cl">                mprevLogTerm   |-&gt; prevLogTerm,
</span></span><span class="line"><span class="cl">                mentries       |-&gt; entries,
</span></span><span class="line"><span class="cl">                \* mlog is used as a history variable for the proof.
</span></span><span class="line"><span class="cl">                \* It would not exist in a real implementation.
</span></span><span class="line"><span class="cl">                mlog           |-&gt; log[i],
</span></span><span class="line"><span class="cl">                mcommitIndex   |-&gt; Min({commitIndex[i], lastEntry}),
</span></span><span class="line"><span class="cl">                msource        |-&gt; i,
</span></span><span class="line"><span class="cl">                mdest          |-&gt; j])
</span></span><span class="line"><span class="cl">    /\ UNCHANGED &lt;&lt;serverVars, candidateVars, leaderVars, logVars&gt;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Paxos vs Raft</p>
</blockquote>
<p>Heidi Howard Âíå Richard Mortier ÂèëË°®‰∫ÜËÆ∫Êñá <a class="link" href="https://arxiv.org/pdf/2004.05074.pdf"  target="_blank" rel="noopener"
    >Paxos vs Raft: Have we reached consensus on distributed consensus?</a> ÊØîËæÉ‰∫Ü‰∏§ËÄÖÁöÑÂå∫Âà´‰∏éËÅîÁ≥ª„ÄÇÂΩìÁÑ∂ÔºåChubby ÁöÑ‰ΩúËÄÖ Mike Burrows ‰πüË°®ÊòéÔºå<a class="link" href="https://medium.datadriveninvestor.com/from-distributed-consensus-algorithms-to-the-blockchain-consensus-mechanism-75ee036abb65"  target="_blank" rel="noopener"
    >There is only one consensus protocol, and that‚Äôs Paxos</a>ÔºàÊâÄÊúâÁöÑÂÖ±ËØÜÁÆóÊ≥ïÊú¨Ë¥®ÈÉΩÊòØ PaxosÔºâ</p>
<p>È¶ñÂÖàÔºå‰∏§‰∏™ÁÆóÊ≥ïÁöÑÂÖ±ÂêåÁÇπÂú®‰∫éÔºö</p>
<ul>
<li>Âè™Êúâ‰∏Ä‰∏™È¢ÜÂØºËÄÖÔºåÊé•ÂèóÊâÄÊúâÂÜôËØ∑Ê±ÇÔºåÂπ∂‰∏îÊääÊó•ÂøóÂèëÈÄÅÁªôËøΩÈöèËÄÖ</li>
<li>Â§öÊï∞Ê¥æÂ§çÂà∂‰∫ÜÊó•ÂøóÂêéÔºåÂàôËØ•Êó•ÂøóÊ∞∏‰πÖÁîüÊïàÂπ∂‰ΩúÁî®‰∫éÊâÄÊúâÁä∂ÊÄÅÊú∫</li>
<li>Â¶ÇÊûúÈ¢ÜÂØºËÄÖÂ§±Ë¥•‰∫ÜÔºåÂ§öÊï∞Ê¥æ‰ºöÈáçÊñ∞ÈÄâ‰∏æÂá∫‰∏Ä‰∏™Êñ∞ÁöÑÈ¢ÜÂØºËÄÖ</li>
</ul>
<p>Raft Áõ∏ÊØî Paxos ÁÆóÊ≥ï‰πüÂ≠òÂú®ËØ∏Â§ö‰ºòÁÇπ„ÄÇRaft ‰ºòÂäøÂú®‰∫éÔºö</p>
<ul>
<li>Ë°®Áé∞ÂΩ¢ÂºèÔºöRaft Êõ¥ÂÆπÊòìÂ≠¶‰π†ÂíåÁêÜËß£ÔºåÂπ∂‰∏îÁªôÂá∫‰∫ÜÁõ∏ÂÖ≥ÁöÑÂÆûÁé∞ÈÄªËæë</li>
<li>ÁÆÄÂçïÊÄßÔºöRaft ÊåâÈ°∫Â∫èÊèê‰∫§Êó•ÂøóÔºåËÄå Paxos ‰∏ç‰øùËØÅÊåâÈ°∫Â∫èÔºåÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÂçèËÆÆÊù•ÂÆûÁé∞„ÄÇËÄå‰∏î Raft ÁöÑÊâÄÊúâÊó•ÂøóÈÉΩÊúâÁõ∏ÂêåÁöÑÁ¥¢Âºï‰ªªÊúüÂíåÂëΩ‰ª§„ÄÇ</li>
<li>È´òÊïàÁöÑÈÄâ‰∏æÁÆóÊ≥ïÔºöRaft ‰ΩøÁî®‰∫ÜÊõ¥Âä†È´òÊïàÁéáÁöÑÈÄâ‰∏æÁÆóÊ≥ïÔºåÂè™ÈúÄË¶ÅÁÆÄÂçïÊØîËæÉ id Âç≥ÂèØÂà§Êñ≠Ë∞ÅËÉúÂá∫„ÄÇ</li>
</ul>
<p>ÊåâÁÖß Heidi Howard ËÆ∫Êñá‰∏≠ÁöÑËØ¥Ê≥ïÔºåÂÆûÈôÖ‰∏ä‰∏§ËÄÖÁõ∏Â∑ÆÈùûÂ∏∏Â∞èÔºåÂæàÂ§öÂú∫ÊôØ‰∏ãÁöÑ‰ºòÂåñÈÉΩÊòØÁõ∏ÈÄöÁöÑ„ÄÇ‰∏ä‰∫§ IPADS ‰πüÂèëË°®‰∫ÜËÆ∫Êñá <a class="link" href="https://arxiv.org/pdf/1905.10786.pdf"  target="_blank" rel="noopener"
    >On the parallels between Paxos and Raft, and how to port optimizations</a>ÔºåË°®Á§∫ËøëÂπ¥Êù• Raft ÁÆóÊ≥ïÂ∑≤ÁªèÊàê‰∏∫‰∫ÜÂÖ±ËØÜÁÆóÊ≥ïÁöÑ‰ºòÂÖàÈÄâÊã©„ÄÇ</p>
<h2 id="54-pbft">5.4. PBFT</h2>
<p>PBFTÔºà<a class="link" href="https://pmg.csail.mit.edu/papers/osdi99.pdf"  target="_blank" rel="noopener"
    >Piratical Byzantine Fault Tolerance</a>ÔºâÊòØÁî± Miguel Castro Âíå Barbara Liskov ÊèêÂá∫ÁöÑ‰∏ÄÁßçÂÆûÁî®ÁöÑÊãúÂç†Â∫≠ÂÆπÈîôÁÆóÊ≥ïÔºå‰πüÁÆóÊòØ‰∏ÄÁßç Paxos ÁÆóÊ≥ïÁöÑ‰∏ÄÁßçÂèò‰ΩìÔºå‰πüÁß∞‰∏∫ Byzantine Paxos ÁÆóÊ≥ï„ÄÇ„ÄÇ</p>
<p>ÂêåÊ≠•ÁéØÂ¢É‰∏ãÔºåÂÆπÈîôÁöÑË¶ÅÊ±ÇÊòØ N &gt;= 3F + 1ÔºàÂÖ∂‰∏≠ F Ë°®Á§∫ÊïÖÈöúËäÇÁÇπÔºåN Ë°®Á§∫ÊÄªËøõÁ®ãÊï∞ÔºâÔºåËôΩÁÑ∂Â≠òÂú®ÊãúÂç†Â∫≠Â∞ÜÂÜõÂ≠òÂú®ÁöÑËß£Á≠îÔºå‰ΩÜÊòØÈúÄË¶ÅÂæàÈ´òÁöÑÂ§çÊùÇÂ∫¶ $O(N^F)$„ÄÇËÄå PBFT Âè™ÈúÄË¶Å $O(N^2)$ ÁöÑ‰ø°ÊÅØ‰∫§Êç¢Èáè„ÄÇ</p>
<p>PBFT ÁÆóÊ≥ïÁöÑÊ†∏ÂøÉÊÄùÊÉ≥ÊòØÈÄöËøá‰∏Ä‰∏™‰∏âÈò∂ÊÆµÁöÑÊ∂àÊÅØ‰∫§‰∫íËøáÁ®ãÊù•ËææÊàêÂÖ±ËØÜ„ÄÇÂÖ∑‰ΩìÊù•ËØ¥ÔºåÊØè‰∏™ËäÇÁÇπÂú®ÊèêÂá∫‰∏Ä‰∏™Êñ∞ÁöÑ‰∫§ÊòìÊàñËÄÖÂå∫ÂùóÂêéÔºå‰ºöÊääËøô‰∏™ËØ∑Ê±ÇÂèëÈÄÅÁªôÂÖ∂‰ªñËäÇÁÇπ„ÄÇÁÑ∂ÂêéÔºåËäÇÁÇπ‰ª¨‰ºöÁªèËøáÈ¢ÑÂáÜÂ§á„ÄÅÂáÜÂ§á„ÄÅÊèê‰∫§‰∏â‰∏™Èò∂ÊÆµÁöÑÊ∂àÊÅØ‰∫§‰∫íÔºåÊù•ËææÊàêÂÖ±ËØÜÂπ∂Â∞ÜËøô‰∏™‰∫§ÊòìÊàñËÄÖÂå∫ÂùóËÆ∞ÂΩïÂà∞Âå∫ÂùóÈìæ‰∏ä„ÄÇ</p>
<p>Áî±‰∫éÂÖ∂ÊØè‰∏™ËäÇÁÇπÈÉΩÈúÄË¶ÅÁªèËøáËÆ∏ÂèØÔºàPermissionedÔºâÊâçËÉΩÂä†ÂÖ•Á≥ªÁªüÔºåËøôÁßçÂå∫ÂùóÈìæ‰πüÁß∞‰∏∫ËÆ∏ÂèØÈìæÔºàPermissioned BlockchainÔºâ„ÄÇË¢´Áî®‰∫éÊùÉÁõäËØÅÊòéÔºàProof of Stake, POSÔºâÁÆóÊ≥ï‰∏≠ÔºåÈÅøÂÖç‰∫ÜËäÇÁÇπÊÅ∂ÊÑèË°å‰∏∫Ôºå‰πü‰∏çÈúÄË¶ÅÊåñÁüøÊµ™Ë¥πÁîµÂäõ„ÄÇ</p>
<h1 id="6-distributed-transactions">6. Distributed Transactions</h1>
<blockquote>
<p>Atomic Commit Protocol, ACP</p>
</blockquote>
<p>ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÁöÑÂéüÂ≠êÊÄßÈÄöËøáÂéüÂ≠êÊèê‰∫§ÂçèËÆÆÔºàAtomic Commit Protocol, ACPÔºâÊù•ÂÆûÁé∞Ôºå‰∏ÄËà¨Êù•ËØ¥ÈúÄË¶ÅÊª°Ë∂≥‰ª•‰∏ã‰∏â‰∏™ÁâπÊÄßÔºö</p>
<ul>
<li>ÂçèÂÆöÊÄßÔºàAgreementÔºâÔºöÊâÄÊúâËøõÁ®ãÈÉΩÂÜ≥ËÆÆÂá∫Âêå‰∏Ä‰∏™ÂÄºÔºåÂç≥ÊâÄÊúâËøõÁ®ãË¶Å‰πàÂêåÊó∂Êèê‰∫§ÔºåË¶Å‰πàÂêåÊó∂ÂõûÊªö</li>
<li>ÊúâÊïàÊÄßÔºàValidityÔºâÔºöÊâÄÊúâËøõÁ®ãÈÉΩÊèê‰∫§‰∏îÊ≤°ÊúâÂºÇÂ∏∏ÔºåÂàôÊúÄÁªàÊï¥‰∏™Á≥ªÁªüÈÉΩË¶ÅÊèê‰∫§‰∫ãÂä°ÔºåÂèç‰πãÁ≥ªÁªüÂ∞ÜÁªàÊ≠¢‰∫ãÂä°</li>
<li>ÁªàÊ≠¢ÊÄßÔºàTerminationÔºâÔºöÂèàÂàÜ‰∏∫Âº±ÁªàÊ≠¢ÔºàWeak TerminationÔºâÊù°‰ª∂ÔºåÂç≥Ê≤°ÊúâÊïÖÈöúÂèëÁîüÊó∂ÔºåÂàôÊâÄÊúâËøõÁ®ãÊúÄÁªàÈÉΩ‰ºö‰ΩúÂá∫ÂÜ≥ÂÆöÔºõÂº∫ÁªàÊ≠¢ÔºàStrong TerminationÔºâÊù°‰ª∂‰πüÁß∞ÈùûÈòªÂ°ûÔºàNon-BlockingÔºâÊù°‰ª∂ÔºåÊåáÁöÑÊòØÔºåÂè™ÊúâÊ≤°ÊúâÂèëÁîüÊïÖÈöúÁöÑÈÇ£‰∫õËøõÁ®ãÊúÄÁªàÊâç‰ºö‰ΩúÂá∫ÂÜ≥ËÆÆ„ÄÇ</li>
</ul>
<h2 id="61-2pc">6.1. 2PC</h2>
<p>‰∏§Èò∂ÊÆµÊèê‰∫§ÔºàTwo-Phase CommitÔºå2PCÔºâÊúâ‰∏§‰∏™Èò∂ÊÆµÁªÑÊàêÔºåÊòØÊúÄÁªèÂÖ∏ÁöÑ ACP ÂçèËÆÆ„ÄÇPingCAP ËÅîÂêàÂàõÂßã‰∫∫ÈªÑ‰∏úÊó≠Âú®ÊºîËÆ≤‰∏≠‰πüË°®Á§∫Ôºå<a class="link" href="https://www.youtube.com/watch?v=xAiuLJtCZOg&amp;t=21s"  target="_blank" rel="noopener"
    >ÊâÄÊúâÁöÑÂàÜÂ∏ÉÂºè‰∫ãÂä°Êú¨Ë¥®ÈÉΩÊòØ 2PC</a>„ÄÇ</p>
<p>2PC ÁöÑÁ¨¨‰∏ÄÈò∂ÊÆµÁß∞‰∏∫ÂáÜÂ§áÈò∂ÊÆµÔºàPrepare PhaseÔºâÊàñËÄÖÊäïÁ•®Èò∂ÊÆµÔºàVote PhaseÔºâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Á¨¨‰∏ÄÈò∂ÊÆµÔºöÂçèË∞ÉËÄÖÂêëÊâÄÊúâÂèÇ‰∏éËÄÖÂèëÈÄÅËØ∑Ê±Ç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">CoordinatorNode</span><span class="p">)</span> <span class="nf">Phase1</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂêëÊâÄÊúâÂèÇ‰∏éËÄÖÂèëÈÄÅËØ∑Ê±ÇÔºåËøô‰∏™Êìç‰ΩúÂèØ‰ª•Âπ∂Ë°åÂ§ÑÁêÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">p</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Participants</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">!</span><span class="nx">p</span><span class="p">.</span><span class="nf">Prepare</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Â¶ÇÊûúÊúâ‰ªª‰Ωï‰∏Ä‰∏™ÂèÇ‰∏éËÄÖËøîÂõûÂ§±Ë¥•ÔºåÂàôÊîæÂºÉÊú¨Ê¨°‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÊâÄÊúâÂèÇ‰∏éËÄÖÈÉΩËøîÂõûÊàêÂäüÔºåÂàôËøõÂÖ•Á¨¨‰∫åÈò∂ÊÆµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂèÇ‰∏éËÄÖËäÇÁÇπÂ§ÑÁêÜËØ∑Ê±Ç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">ParticipantNode</span><span class="p">)</span> <span class="nf">Prepare</span><span class="p">()</span> <span class="p">(</span><span class="nx">ok</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â§ÑÁêÜÂçèË∞ÉËÄÖÁöÑËØ∑Ê±ÇÔºåÊ£ÄÊü•ÊâÄÈúÄÊù°‰ª∂‰ª•ÂèäËµÑÊ∫êÔºåÂπ∂ËøîÂõûÂìçÂ∫îÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Â¶ÇÊûúÂ§ÑÁêÜÊàêÂäüÔºåÂàôËøîÂõû trueÔºåÂê¶ÂàôËøîÂõû false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Á¨¨‰∫åÈò∂ÊÆµÁß∞‰∏∫Êèê‰∫§Èò∂ÊÆµÔºàCommit PhaseÔºâÔºåË¶ÅÊ±Ç‰∏ä‰∏ÄÈò∂ÊÆµÁöÑÊâÄÊúâÂèÇ‰∏éËÄÖÈÉΩÂõûÂ§ç‚ÄúÊòØ‚ÄùÔºåÂàôÂèØ‰ª•ÂêëÊâÄÊúâÂèÇ‰∏éËÄÖÂèëÈÄÅÊ∂àÊÅØÔºåË°®Á§∫Êú¨Ê¨°Êèê‰∫§ÔºåÂè™Ë¶ÅÊúâ‰∏Ä‰∏™ÂèÇ‰∏éËÄÖÂõûÂ§ç‰∫Ü‚ÄúÂê¶‚ÄùÔºåÂàôÂêëÊâÄÊúâÂèÇ‰∏éËÄÖÂèëÈÄÅÁªàÊ≠¢„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Á¨¨‰∫åÈò∂ÊÆµÔºöÂçèË∞ÉËÄÖÊ†πÊçÆÂèÇ‰∏éËÄÖÁöÑÂìçÂ∫îÂÅöÂá∫ÂÜ≥Á≠ñ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">CoordinatorNode</span><span class="p">)</span> <span class="nf">Phase2</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÁªüËÆ°ÊâÄÊúâÂèÇ‰∏éËÄÖÁöÑÂÜ≥Á≠ñÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">trueCount</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="nx">falseCount</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">p</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Participants</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">p</span><span class="p">.</span><span class="nf">Decision</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">trueCount</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">falseCount</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûúÊâÄÊúâÂèÇ‰∏éËÄÖÈÉΩÂ∑≤Êèê‰∫§ÔºåÂàôÊú¨Ê¨°‰∫ãÂä°ÊàêÂäü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">trueCount</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Participants</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">c</span><span class="p">.</span><span class="nf">Commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûúÊúâ‰ªª‰Ωï‰∏Ä‰∏™ÂèÇ‰∏éËÄÖÂ∑≤ÂõûÊªöÔºåÂàôÊîæÂºÉÊú¨Ê¨°‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nx">falseCount</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">c</span><span class="p">.</span><span class="nf">Abort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûúÊúâÂèÇ‰∏éËÄÖÂ∞öÊú™Êèê‰∫§ÊàñÂõûÊªöÔºåÂàôÁ≠âÂæÖ‰∏ã‰∏ÄÊ¨°ÂçèË∞É
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâÄÊúâÂèÇ‰∏éËÄÖÂíåÂçèË∞ÉËÄÖÈÉΩÂ∫îËØ•Êää‰∫ãÂä°Áõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÊåÅ‰πÖÂåñÔºåÂπ∂‰∏îÊâÄÊúâ‰øÆÊîπÊìç‰ΩúÈÉΩÂ∫îËØ•ÂÆûÁé∞ WAL„ÄÇ</p>
<p>ÂÆûÈôÖ‰∏ä 2PC ÂçèËÆÆËøòÂ≠òÂú®ËØ∏Â§öÈóÆÈ¢òÔºö</p>
<ol>
<li>ÈòªÂ°ûÈóÆÈ¢òÔºöÂú®Á¨¨‰∫åÈò∂ÊÆµ‰∏≠ÔºåÂ¶ÇÊûúÂçèË∞ÉËÄÖËäÇÁÇπÊåÇÊéâÊàñËÄÖÁΩëÁªúÂá∫Áé∞ÊïÖÈöúÔºåÂèÇ‰∏éËÄÖËäÇÁÇπ‰ºö‰∏ÄÁõ¥Á≠âÂæÖÔºåÂØºËá¥Êï¥‰∏™Á≥ªÁªüÈòªÂ°û„ÄÇ</li>
<li>ÂçïÁÇπÊïÖÈöúÈóÆÈ¢òÔºöÂú®Á¨¨‰∏ÄÈò∂ÊÆµ‰∏≠ÔºåÂ¶ÇÊûúÂçèË∞ÉËÄÖËäÇÁÇπÊåÇÊéâÔºåÈúÄË¶ÅÈÄâ‰∏æÊñ∞ÁöÑÂçèË∞ÉËÄÖËäÇÁÇπÊù•ÁªßÁª≠ËøõË°å‰∫ãÂä°ÁöÑÂ§ÑÁêÜÔºå‰ΩÜÊòØÈÄâ‰∏æËøáÁ®ãÊú¨Ë∫´‰πüÂèØËÉΩÂá∫Áé∞ÊïÖÈöúÔºå‰ªéËÄåÂØºËá¥Êï¥‰∏™Á≥ªÁªü‰∏çÂèØÁî®„ÄÇ</li>
<li>Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÈóÆÈ¢òÔºöÂú®Á¨¨‰∫åÈò∂ÊÆµ‰∏≠ÔºåÂ¶ÇÊûúÊúâÂèÇ‰∏éËÄÖËäÇÁÇπÂá∫Áé∞ÊïÖÈöúÔºåÂØºËá¥ÂÆÉÊó†Ê≥ïÊèê‰∫§ÊàñÂõûÊªöÔºå‰ºöÂØºËá¥Êï∞ÊçÆÂá∫Áé∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ„ÄÇ</li>
<li>ÊÄßËÉΩÈóÆÈ¢òÔºöÁî±‰∫é 2PC ÈúÄË¶ÅËøõË°å‰∏§ËΩÆÊ∂àÊÅØ‰∫§‰∫íÔºåÂõ†Ê≠§ÂÆÉÁöÑÊÄßËÉΩÊØîËæÉ‰ΩéÔºåÂ∞§ÂÖ∂ÊòØÂú®ÂèÇ‰∏éËÄÖËäÇÁÇπËæÉÂ§öÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ºöÂØºËá¥Ê∂àÊÅØ‰º†ÈÄíÁöÑÂª∂ËøüÂíåË¥üËΩΩÂ¢ûÂä†ÔºåËøõËÄåÂΩ±ÂìçÊï¥‰∏™Á≥ªÁªüÁöÑÊÄßËÉΩ„ÄÇ</li>
<li>ÂèØÁî®ÊÄßÈóÆÈ¢òÔºöÁî±‰∫é 2PC ÈúÄË¶ÅÂçèË∞ÉËÄÖËäÇÁÇπÂíåÂèÇ‰∏éËÄÖËäÇÁÇπ‰πãÈó¥ÁöÑÂØÜÂàáÂçè‰ΩúÔºåÂõ†Ê≠§Âú®ÂàÜÂ∏ÉÂºèÁ≥ªÁªü‰∏≠ÔºåÂ¶ÇÊûúÂçèË∞ÉËÄÖËäÇÁÇπÊàñÂèÇ‰∏éËÄÖËäÇÁÇπÁöÑÊï∞ÈáèËæÉÂ§öÔºå‰ºöÂØºËá¥Á≥ªÁªüÁöÑÂèØÁî®ÊÄßÈôç‰Ωé„ÄÇ</li>
</ol>
<p>CockroachDB ÊèêÂá∫‰∫Ü‰∏ÄÁßç <a class="link" href="https://www.cockroachlabs.com/blog/parallel-commits/"  target="_blank" rel="noopener"
    >Parallel Commits</a> ÁöÑ‰ºòÂåñÊÄùË∑ØÔºåÂú®Á¨¨‰∏ÄÈò∂ÊÆµÔºåCoordinator Â∑≤ÁªèÁü•ÈÅì‰∫ÜÊòØÂê¶Â∫îËØ•Êèê‰∫§‰∫ãÂä°ÔºåËøô‰∏™Áä∂ÊÄÅÂèØ‰ª•Â∞ÜÁ¨¨‰∏ÄÈò∂ÊÆµÁöÑËøîÂõûÁõ¥Êé•‰∫§ÁªôÂÆ¢Êà∑Á´ØÔºåÂπ∂Â∞ÜÁ¨¨‰∏ÄÈò∂ÊÆµÁöÑËäÇÁÇπÁä∂ÊÄÅÂÜôËøõÂÖ®Â±Ä‰∫ãÂä°ÁöÑÊó•Âøó‰∏≠ÔºåÈóÆÈ¢òÂèëÁîüÊó∂Ôºå‰æøÂèØ‰ª•Êü•ËØ¢ÂÖ∂‰ªñËäÇÁÇπÂ§ÑÁêÜÂºÇÂ∏∏ÊÉÖÂÜµ„ÄÇ</p>
<h2 id="62-3pc">6.2. 3PC</h2>
<p>3PC ‰∏ªË¶ÅÁî®‰∫éËß£ÂÜ≥ 2PC ÁöÑÊèê‰∫§ÂçèËÆÆÈòªÂ°ûÊÄßËøô‰∏ÄÁº∫ÁÇπËÄåËÆæËÆ°ÁöÑÔºåÂèÇ‰∏éËÄÖ‰∏çÁü•ÈÅìÁ¨¨‰∏ÄÈò∂ÊÆµÁöÑÁªìÊûúÔºå3PC ÂàôÂú® 2PC ÁöÑ‰∏§‰∏™Èò∂ÊÆµ‰∏≠Èó¥Ê∑ªÂä†‰∫Ü‰∏Ä‰∏™È¢ÑÊèê‰∫§Èò∂ÊÆµÔºàPrepare to Commit, Pre-CommitÔºâÔºåËøô‰∏ÄÈò∂ÊÆµÔºåÂçèË∞ÉËÄÖÂ∞ÜÁ¨¨‰∏ÄËΩÆÁöÑÊäïÁ•®ÁªìÊûúÂèëÈÄÅÁªôÊâÄÊúâÂèÇ‰∏éËÄÖÔºåËøôÊ†∑Â¶ÇÊûúËøêË°åÊó∂Âá∫Áé∞‰∫ÜÊïÖÈöúÔºåÂàôÂèØ‰ª•‰ªéÂâ©‰∏ãÁöÑÂèÇ‰∏éËÄÖ‰∏≠ÈáçÊñ∞ÈÄâ‰∏æÂá∫ÂçèË∞ÉËÄÖÔºåÊñ∞ÁöÑÂçèË∞ÉËÄÖÂèØ‰ª•ÈáçÊñ∞ÈÄâÊã©ÊòØÊèê‰∫§ËøòÊòØÁªàÊ≠¢„ÄÇ</p>
<p>3PC ÊûÅÊòìÂèóÂà∞ÁΩëÁªúÂàÜÂå∫ÁöÑÂΩ±ÂìçÔºåËÄå‰∏î‰∏ÄÊ¨°‰∫ãÂä°Ëá≥Â∞ëÈúÄË¶Å 3 Ê¨°Ê∂àÊÅØÂæÄËøîÔºåÂ¢ûÂä†‰∫Ü‰∫ãÂä°ÂÆåÊàêÊó∂Èó¥„ÄÇÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãËøòÊòØÈÄâÊã©‰ΩøÁî® 2PC ÂçèËÆÆ„ÄÇ</p>
<h2 id="63-paxos-commit">6.3. Paxos Commit</h2>
<p>James Gray Âíå Lamport ÂÖ±ÂêåÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://lamport.azurewebsites.net/video/consensus-on-transaction-commit.pdf"  target="_blank" rel="noopener"
    >Consensus on Transaction Commit</a> ÊèêÂá∫‰∫Ü Paxos Êèê‰∫§ÁÆóÊ≥ï„ÄÇËØ•ÁÆóÊ≥ï‰∏ªË¶ÅÊúâ‰∏â‰∏™ËßíËâ≤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ResourceManager</span> <span class="p">=</span> <span class="kc">iota</span> <span class="c1">// ËµÑÊ∫êÁÆ°ÁêÜËÄÖÔºåÈõÜÁæ§‰∏≠Êúâ N ‰∏™ËµÑÊ∫êÁÆ°ÁêÜËÄÖÔºåÊØè‰∏™ÈÉΩ‰ª£Ë°®‰∏ÄÁªÑ Paxos ÂÆû‰æãÁöÑÊèêÊ°àÂèëËµ∑ËÄÖ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Leader</span>                 <span class="c1">// È¢ÜÂØºËÄÖÔºåÂè™Êúâ‰∏Ä‰∏™È¢ÜÂØºËÄÖÔºåÁî®‰∫éÂçèË∞ÉÊï¥‰∏™ÁÆóÊ≥ïÔºåÁî± Paxos ÁÆóÊ≥ïÈÄâ‰∏æÂá∫Êù•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">Acceptors</span>              <span class="c1">// Êé•ÂèóËÄÖÔºå‰∏éËµÑÊ∫êÁÆ°ÁêÜËÄÖÂÖ±ÂêåÁªÑÊàê Paxos ÂÆû‰æãÔºåRM ÂÖ±‰∫´ÊâÄÊúâÊé•ÂèóËÄÖÔºå2F+1 Êé•ÂèóËÄÖÂèØ‰ª•ÂÖÅËÆ∏ F ‰∏™ÊïÖÈöú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÆåÊï¥ÁöÑÊèê‰∫§ÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<ol>
<li>‰ªªÊÑè‰∏Ä‰∏™ RM Êèê‰∫§‰∫ãÂä°‰ª•ÂêéÔºåÂèëÈÄÅ BeginCommit Áªô LeaderÔºåËØ∑Ê±ÇÊèê‰∫§ËØ•‰∫ãÂä°</li>
<li>Leader Êî∂Âà∞Ê∂àÊÅØÂêéÔºåÂêëÊâÄÊúâÁöÑ RM ÂèëÈÄÅ Prepare Ê∂àÊÅØ</li>
<li>RM Êî∂Âà∞ Prepare Ê∂àÊÅØÂêéÔºåÂ¶ÇÊûúÊù°‰ª∂ÂÖÅËÆ∏‰∫ãÂä°Êèê‰∫§ÔºåÂàôÂêëÊâÄÊúâÊé•ÂèóËÄÖÂèëÈÄÅÂ∏¶ÊúâÊèêÊ°àÁºñÂè∑‰∏éÂÄº‰∏∫ Prepared Ê∂àÊÅØÔºõÂèç‰πãÂèëÈÄÅ Aborted Ê∂àÊÅØÔºõÊï¥‰∏™Ëøô‰∏™Èò∂ÊÆµ‰πüÁß∞‰∏∫ Phase 2a Ê∂àÊÅØ„ÄÇ</li>
<li>Êé•ÂèóËÄÖÊî∂Âà∞ Phase 2a Ê∂àÊÅØÂêéÔºåÂ¶ÇÊûúÊ≤°ÊúâÊõ¥Â§ßÊèêÊ°àÁºñÂè∑ÁöÑÊ∂àÊÅØÔºåÂàôÊé•ÂèóËØ•Ê∂àÊÅØÔºåÂπ∂ÂõûÂ§çÊèêÊ°àÁºñÂè∑‰∏éÂÄºÁöÑ Phase 2b Ê∂àÊÅØÔºõÂ¶ÇÊûúÂ∑≤ÁªèÊúâ‰∫ÜÊèêÊ°àÁºñÂè∑Êõ¥Â§ßÁöÑÊ∂àÊÅØÔºåÂàôÊãíÁªùËøôÊù°Ê∂àÊÅØ„ÄÇ</li>
<li>ÂØπ‰∫éÊØè‰∏ÄÁªÑ Paxos ÂÆû‰æãÔºåLeader Â¶ÇÊûúÊî∂Âà∞‰∫Ü F+1 Êù°ÂêåÊ†∑ÁºñÂè∑ÁöÑÊ∂àÊÅØÔºåÊ†πÊçÆ Paxos ÁÆóÊ≥ïÔºåÁÆ°ÁêÜ‰ºöÈÄâÂÆöËøô‰∏™ÂÄº„ÄÇ</li>
<li>ÊØè‰∏Ä‰∏™ Paxos ÂÆû‰æãÈÉΩÈÄâÊã©ÂÆåÊØïÂêéÔºåLeader ÊúÄÁªàÁ°ÆËÆ§ÔºåÂ¶ÇÊûúÊØè‰∏™ÂÄºÈÉΩÊòØ PreparedÔºå‰ª£Ë°®‰∏ÄËá¥ËÆ§‰∏∫Ëøô‰∏™ÂÄºËÉΩË¢´Êèê‰∫§ÔºåLeader ÂêëÊâÄÊúâ RM ÂèëÈÄÅÊèê‰∫§Ê∂àÊÅØÔºåRM Êî∂Âà∞Ê∂àÊÅØÂêéÂØπ‰∫ãÂä°ËøõË°åÊèê‰∫§„ÄÇ</li>
<li>Â¶ÇÊûú Leader ÂèëÁé∞Êúâ‰∏Ä‰∏™ RM ÁöÑÂÄºÊúâ‰∏Ä‰∏™ÊòØ AbortedÔºåÂç≥ÊúâÁöÑ RM Â∏åÊúõÁªàÊ≠¢‰∫ãÂä°ÔºåÂàôÈ¢ÜÂØºËÄÖÂêëÊâÄÊúâ RM ÂèëÈÄÅ‰∏≠Ê≠¢Ê∂àÊÅØÔºåRM Êî∂Âà∞Ê∂àÊÅØÂêé‰∏≠Ê≠¢‰∫ãÂä°„ÄÇ</li>
</ol>
<h2 id="64-saga">6.4. Saga</h2>
<p>Hector Âíå Kenneth ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://www.cs.cornell.edu/andru/cs711/2002fa/reading/sagas.pdf"  target="_blank" rel="noopener"
    >SAGAS</a> ÂÆö‰πâ‰∫Ü‰∏ÄÁßçÈïøÊ¥ª‰∫ãÂä°ÔºàLong-Lived Transaction, LLTÔºâÔºåÂÖ∂Êú¨Ë¥®Áî±‰∏ÄËøû‰∏≤Â≠ê‰∫ãÂä° T1„ÄÅT2„ÄÅ&hellip; Tn ÁªÑÊàêÔºåÂèØ‰ª•‰∏éÂÖ∂‰ªñ‰∫ãÂä°‰∫§ÈîôËøêË°åÔºå‰æùÁÑ∂ËÉΩÂ§ü‰øùËØÅÊâÄÊúâ‰∫ãÂä°ÂÖ®ÈÉ®ÊàêÂäüÊàñËÄÖÂÖ®ÈÉ®Â§±Ë¥•ÔºåÊØè‰∏™Â≠ê‰∫ãÂä° Tx ÈÉΩÂØπÂ∫î‰∏Ä‰∏™Ë°•ÂÅøÁöÑ‰∫ãÂä° Cx ÔºåË°•ÂÅø‰∫ãÂä°Âú®ÂõûÊªöÁöÑÊó∂ÂÄôÊâßË°å„ÄÇ</p>
<h2 id="65-percolator">6.5. Percolator</h2>
<p>Google ÂèëË°®ÁöÑËÆ∫Êñá <a class="link" href="https://www.usenix.org/legacy/event/osdi10/tech/full_papers/Peng.pdf"  target="_blank" rel="noopener"
    >Large-scale Incremental Processing Using Distributed Transactions and Notifications</a> ‰ªãÁªç‰∫Ü Percolator ÁöÑÊû∂ÊûÑËÆæËÆ°„ÄÇPercolator ‰æùËµñ‰∫é‰∏Ä‰∏™ÂçïÁÇπÊéàÊó∂ÔºåÂçïÊó∂Èó¥Ê∫êÁöÑÊéàÊó∂ÊúçÂä°ÔºåÁß∞‰∏∫ TSOÔºàTimestamp OracleÔºâÔºåÁî®‰∫éÁªô‰∫ãÂä°ÂàÜÈÖçÊó∂Èó¥Êà≥Ôºå‰ª•‰∏ãÊòØÂØπËÆ∫Êñá‰∏≠‰ª£Á†ÅÁöÑËß£Èáä„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Transaction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">Write</span> <span class="p">{</span> <span class="n">Row</span> <span class="n">row</span><span class="p">;</span> <span class="n">Column</span> <span class="n">col</span><span class="p">;</span> <span class="n">string</span> <span class="n">value</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Write</span><span class="o">&gt;</span> <span class="n">writes_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">start_ts_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 1. ÂàÜÈÖçÂàÜÂ∏ÉÂºèÂºÄÂßãÁöÑÊó∂Èó¥Êà≥ÔºåÂºÄÂßãÁöÑÊó∂Èó¥Êà≥ÂÜ≥ÂÆö‰∫ÜËØ•‰∫ãÂä°ÁúãÂà∞ÁöÑÁâàÊú¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Transaction</span><span class="p">()</span><span class="o">:</span> <span class="n">start_ts_</span><span class="p">(</span><span class="n">oracle</span><span class="p">.</span><span class="n">GetTimestamp</span><span class="p">())</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. ÂØπ‰∫éÂÜôÊìç‰ΩúÔºåÂ∞ÜÊìç‰ΩúÊîæÂÖ• BufferÔºåÁõ¥Âà∞Êèê‰∫§Êâç‰∏ÄÂπ∂ÂÜôÂÖ•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">Set</span><span class="p">(</span><span class="n">Write</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span> <span class="n">writes_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">w</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2. ÂØπ‰∫éËØªÊìç‰ΩúÔºåÊåâÁÖßÂø´ÁÖßÈöîÁ¶ªÁöÑË¶ÅÊ±ÇÔºåÂÖÅËÆ∏ start_ts_ ÂêéÁöÑ‰∫ãÂä°Êã•ÊúâË°åÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">Get</span><span class="p">(</span><span class="n">Row</span> <span class="n">row</span><span class="p">,</span> <span class="n">Column</span> <span class="n">c</span><span class="p">,</span> <span class="n">string</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">bigtable</span><span class="o">::</span><span class="n">Txn</span> <span class="n">T</span> <span class="o">=</span> <span class="n">bigtable</span><span class="o">::</span><span class="n">StartRowTransaction</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Check for locks that signal concurrent writes.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;lock&#34;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_ts_</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// There is a pending lock; try to clean it and wait
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">BackoffAndMaybeCleanupLock</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// Find the latest write below our start timestamp.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">latest_write</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;write&#34;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_ts_</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">latest_write</span><span class="p">.</span><span class="n">found</span><span class="p">())</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// no data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kt">int</span> <span class="n">data_ts</span> <span class="o">=</span> <span class="n">latest_write</span><span class="p">.</span><span class="n">start_timestamp</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">T</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;data&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">data_ts</span><span class="p">,</span> <span class="n">data_ts</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3. È¢ÑÂÜôÔºàPreWriteÔºâÈò∂ÊÆµÔºåÂç≥ 2PC ÁöÑÁ¨¨‰∏ÄÈò∂ÊÆµ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÈÄâÊã©‰∏Ä‰∏™ÂÜôÊìç‰Ωú‰Ωú‰∏∫‰∏ªÔºàPrimaryÔºâÈîÅÔºåÂÖ∂‰ªñÊìç‰Ωú‰Ωú‰∏∫Ê¨°ÔºàSecondÔºâÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÁêÜËÆ∫‰∏äÔºå‰∏ªÈîÅÂèØ‰ª•Èöè‰æøÈÄâÔºåËÆ∫Êñá‰∏≠ÈÄâÊã©‰∫ÜÁ¨¨‰∏Ä‰∏™ÂÜôÊìç‰Ωú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Prewrite tries to lock cell w, returning false in case of conflict.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">Prewrite</span><span class="p">(</span><span class="n">Write</span> <span class="n">w</span><span class="p">,</span> <span class="n">Write</span> <span class="n">primary</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Column</span> <span class="n">c</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">col</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂêØÂä®‰∏Ä‰∏™ Bigtable ÁöÑÂçïË°å‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">bigtable</span><span class="o">::</span><span class="n">Txn</span> <span class="n">T</span> <span class="o">=</span> <span class="n">bigtable</span><span class="o">::</span><span class="n">StartRowTransaction</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Ê£ÄÊü•ÂΩìÂâçÂÜôÊìç‰ΩúÊâÄÊ∂âÂèäÁöÑÊâÄÊúâ write ÂÖÉÊï∞ÊçÆ‰ø°ÊÅØÔºåÂ¶ÇÊûúÊúâÂÖ∂‰ªñ‰∫ãÂä°Âú®ÂΩìÂâç‰∫ãÂä°‰πãÂêé
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Âç≥Êó∂Èó¥Êà≥‰∏∫ [start, +‚àû)ÔºåÂ¶ÇÊûúÊúâÔºåÂàôÁ´ãÂç≥ÁªàÊ≠¢ÂΩìÂâç‰∫ãÂä°ÔºåÂèç‰πãÂàôÂèØ‰ª•‰∏ã‰∏ÄÊ≠•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Abort on writes after our start timestamp . . .
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;write&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">start_ts_</span><span class="p">,</span> <span class="err">‚àû</span><span class="p">]))</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Ê£ÄÊü•ÂΩìÂâçÂÜôÊìç‰ΩúÊâÄÊ∂âÂèäÁöÑ Lock ÂàóÔºåÊ£ÄÊü•ÊòØÂê¶ÊúâÂÖ∂‰ªñ‰∫ãÂä°ÊåÅÊúâÂΩìÂâçË°åÁöÑÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Â¶ÇÊûúÂ∑≤ÁªèÊúâÈîÅÔºåPercolator ‰∏ç‰ºöÁ≠âÈîÅÔºåËÄåÊòØÁõ¥Êé•ÁªàÊ≠¢‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// . . . or locks at any timestamp.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;lock&#34;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="err">‚àû</span><span class="p">]))</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// È°∫Âà©ÈÄöËøáÊ£ÄÊü•‰ª•ÂêéÔºåÂºÄÂßãÊõ¥Êñ∞Êï∞ÊçÆÔºå‰ª•ÂºÄÂßãÁöÑÊó∂Èó¥Êà≥‰Ωú‰∏∫ Bigtable ÁöÑÊó∂Èó¥Êà≥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// ËøôÈáåÁöÑ Write ‰∏ç‰ºöË¶ÜÁõñÂÖÉÊï∞ÊçÆÔºåËÄåÊòØ Append Êìç‰Ωú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">T</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;data&#34;</span><span class="p">,</span> <span class="n">start_ts_</span><span class="p">,</span> <span class="n">w</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Êï∞ÊçÆÊõ¥Êñ∞‰ª•ÂêéÔºåËé∑ÂèñÂØπÂ∫îÁöÑË°åÈîÅÔºå‰ª• primary ÁöÑ row Âíå col ÂÜôÂÖ• lock Âàó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">T</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="s">&#34;lock&#34;</span><span class="p">,</span> <span class="n">start_ts_</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span><span class="n">primary</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">primary</span><span class="p">.</span><span class="n">col</span><span class="p">});</span> <span class="c1">// The primary‚Äôs location.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">T</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 4. Êèê‰∫§‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="nf">Commit</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Write</span> <span class="n">primary</span> <span class="o">=</span> <span class="n">writes_</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">vector</span><span class="o">&lt;</span><span class="n">Write</span><span class="o">&gt;</span> <span class="n">secondaries</span><span class="p">(</span><span class="n">writes_</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">writes_</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Prewrite</span><span class="p">(</span><span class="n">primary</span><span class="p">,</span> <span class="n">primary</span><span class="p">))</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">Write</span> <span class="nl">w</span> <span class="p">:</span> <span class="n">secondaries</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Prewrite</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">primary</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Ëé∑ÂèñÊèê‰∫§ÁöÑÊó∂Èó¥Êà≥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">commit_ts</span> <span class="o">=</span> <span class="n">oracle</span><span class="p">.</span><span class="n">GetTimestamp</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Commit primary first.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Write</span> <span class="n">p</span> <span class="o">=</span> <span class="n">primary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">bigtable</span><span class="o">::</span><span class="n">Txn</span> <span class="n">T</span> <span class="o">=</span> <span class="n">bigtable</span><span class="o">::</span><span class="n">StartRowTransaction</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">row</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂØπ‰∫é‰∏ªÈîÅÂêØÂä®ÁöÑÂçïË°å‰∫ãÂä°ÔºåÊ£ÄÊü•‰∫ãÂä°ÊòØÂê¶ÊåÅÊúâ lock ÂàóÁöÑÈîÅÔºåÂ¶ÇÊûúÊ£ÄÊü•Â§±Ë¥•ÔºåÂàôÁªàÊ≠¢‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">T</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="s">&#34;lock&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">start_ts_</span><span class="p">,</span> <span class="n">start_ts_</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// aborted while working
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Â¶ÇÊûú‰∫ãÂä°‰ªçÁÑ∂ÊåÅÊúâÈîÅÔºå‰ª•Êèê‰∫§Êó∂Èó¥Êà≥‰Ωú‰∏∫ BigTable ÁöÑÊó∂Èó¥Êà≥ÔºåËÆ©ËØ•Êï∞ÊçÆÂØπÂÖ∂‰ªñ‰∫ãÂä°ÂèØËßÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">T</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="s">&#34;write&#34;</span><span class="p">,</span> <span class="n">commit_ts</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">start_ts_</span><span class="p">);</span> <span class="c1">// Pointer to data written at start ts.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// ÈáäÊîæ‰∏ªÈîÅÔºåÊ£ÄÊü•‰∏ªÈîÅÁöÑÂÜôÊìç‰ΩúÊòØÂê¶ÂØπÂÖ∂‰ªñ‰∫ãÂä°ÂèØËßÅÔºåÂ¶ÇÊûúÂ§±Ë¥•ÂàôÁªàÊ≠¢‰∫ãÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">T</span><span class="p">.</span><span class="n">Erase</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="s">&#34;lock&#34;</span><span class="p">,</span> <span class="n">commit_ts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">T</span><span class="p">.</span><span class="n">Commit</span><span class="p">())</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// commit point
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ‰∏ªÈîÅÁöÑÂÜôÊìç‰ΩúÊèê‰∫§‰ª•ÂêéÔºåPercolator ËÆ§‰∏∫Êï¥‰∏™‰∫ãÂä°Â∑≤ÁªèÂÆåÊàêÔºåËøõÂÖ•Á¨¨‰∫åÈò∂ÊÆµ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// ÊâÄÊúâÊ¨°ÈîÅÁöÑÂÜôÊìç‰ΩúÂÖ®ÈÉΩÂèØ‰ª•Êõ¥Êñ∞ÔºåËøô‰∏™Êìç‰ΩúÂèØ‰ª•ÂºÇÊ≠•ÊâßË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Second phase: write out write records for secondary cells.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="n">Write</span> <span class="nl">w</span> <span class="p">:</span> <span class="n">secondaries</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">bigtable</span><span class="o">::</span><span class="n">Write</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">w</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="s">&#34;write&#34;</span><span class="p">,</span> <span class="n">commit</span> <span class="n">ts</span><span class="p">,</span> <span class="n">start</span> <span class="n">ts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">bigtable</span><span class="o">::</span><span class="n">Erase</span><span class="p">(</span><span class="n">w</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">w</span><span class="p">.</span><span class="n">col</span> <span class="o">+</span> <span class="s">&#34;lock&#34;</span><span class="p">,</span> <span class="n">commit</span> <span class="n">ts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span> <span class="c1">// class Transaction
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Percolator ‰ºòÁÇπÂú®‰∫éÊùæËÄ¶ÂêàÔºå‰ΩÜÊòØÁî±‰∫éÂçïÁÇπÊéàÊó∂ÁöÑÊúçÂä°ÔºåÂπ∂‰∏îÈúÄË¶Å‰∏éÊéàÊó∂ÊúçÂä°ÈÄö‰ø°‰∏§Ê¨°ÔºåÊâÄ‰ª•ÂæàÂÆπÊòìÊàê‰∏∫ÊÄßËÉΩÁì∂È¢à„ÄÇ</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span><a class="link" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ml"  target="_blank" rel="noopener"
    >Licensed under CC BY-NC-SA 4.0</a></span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="Chasing1020/Chasing1020.github.io"
    data-repo-id="R_kgDOGR5Ifw"
    data-category="General"
    data-category-id="DIC_kwDOGR5If84CURCm"
    data-mapping="url"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>

<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2023 Chasing1020
    </section>
    
    <section class="powerby">
        
            I just want a peaceful life without troubles <br/>
        Built with <b><a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a></b> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-CDYPFNXQDZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CDYPFNXQDZ');
</script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css?family=JetBrains+Mono";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


    </body>
</html>
